<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
    <title>Rails integration - Trailblazer</title>
    <meta content="width=device-width,initial-scale=1" name="viewport"/>
    
    
    <link rel="stylesheet" href="/assets/tailwind-6c304c20a9393de38f3935921f47da4aba5f25fea37a895a88301943fa61809a.css" />
<link rel="stylesheet" href="/assets/inter-font-8c3e82affb176f4bca9616b838d906343d1251adc8408efe02cf2b1e4fcf2bc4.css" />
    <link rel="stylesheet" href="/assets/application-9915db70b6ec78b594924b5260f77917dbde4dfa05406926e8065c51138be1c6.css" />
    <script>pageIdentifier = "docs";</script>
    <script type="importmap" data-turbo-track="reload">{
  "imports": {
    "application": "/assets/application-840139e27b33cd120687852d38911c11e91b076728d40aca3b48439d857c60ad.js",
    "anchor-js": "/assets/anchor-js-821952d04abcd941bb3541822cd1c1f0234e5168bef1f9b2a050868af608aa5a.js",
    "navigations": "/assets/navigations-27f57ba888008b48256d2635e15bd2f0be7a039b32c8e84140da87596cbf9547.js",
    "docsearch": "/assets/docsearch-cea68a0a1429b11b747954b90c49d36b8f211dbea62e82d79ff0c7bef5226dc2.js",
    "highlight.js/lib/core": "/assets/highlight.js--lib--core-d83dc99104442fb344c757a56d28fa888edee01ed7e6dad88a445f7c7ec6d4c9.js",
    "highlight.js/lib/languages/ruby": "/assets/highlight.js--lib--languages--ruby-f74e4cf7cb12132c4f16865b466beac81cd62a84a8119ebf005060b9d5945175.js",
    "jquery": "/assets/jquery-9292661fe0d8c5ef2ef35f5ca64d541d70c87e9f6d7f2716d646591a295b7f36.js",
    "jquery.parallax-scroll": "/assets/jquery.parallax-scroll-a50d2125650d18a234bc9a3eea0a0f1c40871f3ccfba877d0eae70e690955825.js",
    "@docsearch/js": "https://cdn.jsdelivr.net/npm/@docsearch/js@3.5.2/dist/umd/index.min.js"
  }
}</script>
<link rel="modulepreload" href="/assets/application-840139e27b33cd120687852d38911c11e91b076728d40aca3b48439d857c60ad.js">
<link rel="modulepreload" href="/assets/anchor-js-821952d04abcd941bb3541822cd1c1f0234e5168bef1f9b2a050868af608aa5a.js">
<script src="/assets/es-module-shims.min-4ca9b3dd5e434131e3bb4b0c1d7dff3bfd4035672a5086deec6f73979a49be73.js" async="async" data-turbo-track="reload"></script>
<script type="module">import "application"</script>

    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  </head>
  <body>
    <nav class=" text-base z-[50] top-0 absolute w-full lg:h-[5.5rem] lg:px-[5.6rem] py-3 lg:flex lg:justify-between lg:items-center bg-white sticky" id="navbar">
  <a href="/2.1" class="block shrink-0 w-fit mx-auto lg:mx-0">
    <img class="w-40 lg:my-0" src="/assets/logo_blue_ruby-e87334a67ff20033fae8c8d2c07e549b5f1faa9b75bb07fbb2ff9d1c0dfef6e7.svg" />
  </a>
  <div class="lg:hidden absolute right-4 top-2 flex w-9 h-9 items-center" id="hamburgerIcon">
    <div class="pointer-events-none w-full h-0.5 bg-blue transition-all duration-150
                  before:content-[''] before:absolute before:w-full before:h-0.5 before:bg-blue before:-translate-y-2.5 before:transition-all before:duration-150
                  after:content-[''] after:absolute after:w-full after:h-0.5 after:bg-blue after:translate-y-2.5 after:transition-all after:duration-150"></div>
  </div>
  <div class="lg:hidden flex flex-col text-center hidden" id="navList">
    <div class="lg:absolute flex flex-col mt-15 gap-10 uppercase">
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/docs/trailblazer">Documentation</a>
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="https://dev.to/trailblazer">Blog</a>
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/about.html">About</a>
      
      <!-- <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/pro.html">PRO</a> -->
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="https://trailblazer.zulipchat.com">Chat with us</a>
    </div>
  </div>
  <div class="lg:flex hidden gap-10 items-center">
    <div class="flex gap-7">
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold underline decoration-[5px] underline-offset-[15px] decoration-purple hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/docs/trailblazer">Documentation</a>
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="https://dev.to/trailblazer">Blog</a>
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/about.html">About</a>
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.0/">→ 2.0</a>
      
      <!-- <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/pro.html">PRO</a> -->
    </div>

    <a class="base-button text-base w-[12.5rem] h-[3.25rem] bg-light-purple text-blue hover:text-white hover:bg-purple" href="https://trailblazer.zulipchat.com">Chat with us</a>
  </div>
</nav>

<section>
  <div class="lg:hidden bg-bg-blue text-white fixed left-0 top-20 pr-1 py-3 rounded-r" id="sideNavShowButton" style="writing-mode: vertical-rl; text-orientation: upright;">
    Chapters
  </div>
  <div class="lg:flex">
    <nav class="bg-bg-blue w-screen h-screen fixed top-0 z-20 right-[100vw] overflow-y-scroll lg:w-3/12 lg:max-w-[23rem] lg:overflow-y-visible lg:shrink-0 lg:sticky lg:top-[5.5rem]" id="sideNav">
      <button class="lg:hidden absolute right-4 top-4 text-3xl text-white" id="sideNavHideButton">
        X
      </button>
      <div class="lg:pt-10 lg:pl-5 xl:pl-20 p-10 pl-20 text-white leading-10 space-y-1 h-full overflow-auto">
  


  
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/trailblazer/index.html">Trailblazer</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/operation/index.html">Operation</a>

        

          

            
              <a href="/2.1/docs/activity/deprecated/index.html" class="" title="Deprecated activity docs: :input/:output, ...">
                
                    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512" class="fill-grey pl-3 hover:fill-purple flex-inline"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M251.7 127.6l0 0c10.5 10.5 24.7 16.4 39.6 16.4H448c8.8 0 16 7.2 16 16v32H48V96c0-8.8 7.2-16 16-16H197.5c4.2 0 8.3 1.7 11.3 4.7l33.9-33.9L208.8 84.7l42.9 42.9zM48 240H464V416c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V240zM285.7 93.7L242.7 50.7c-12-12-28.3-18.7-45.3-18.7H64C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H291.3c-2.1 0-4.2-.8-5.7-2.3z"/></svg>
                 
              </a>

            


          

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class="bg-dark-purple flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/rails_integration/index.html">Rails integration</a>

        
      </div>


      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-rails-integration-controller">
          <a href="#rails-integration-controller" class="pl-8">Controller</a>
        </div>
      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-rails-integration-cells">
          <a href="#rails-integration-cells" class="pl-8">Cells</a>
        </div>
      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-rails-integration-reform">
          <a href="#rails-integration-reform" class="pl-8">Reform</a>
        </div>
      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-rails-integration-loader">
          <a href="#rails-integration-loader" class="pl-8">Loader</a>
        </div>
      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/test/index.html">Test</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col border-t-[1px] border-t-light-purple">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/macro/index.html">Macro</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/workflow/index.html">Workflow</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/endpoint/index.html">Endpoint</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/internals/index.html">Internals</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col border-t-[1px] border-t-light-purple">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/reform/index.html">Reform</a>

        

          

            

              <a href="/2.1/docs/reform/3.0/index.html" class="">
                <span class="h-5 text-[8pt] py-[3px] px-2 rounded-[8px] ml-3 hover:bg-purple hover:border-purple hover:text-white border border-grey text-grey">
                  3.0
                </span>
              </a>
            


          

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/cells/index.html">Cells</a>

        

          

            

              <a href="/2.1/docs/cells/5.0/index.html" class="">
                <span class="h-5 text-[8pt] py-[3px] px-2 rounded-[8px] ml-3 hover:bg-purple hover:border-purple hover:text-white border border-grey text-grey">
                  5.0
                </span>
              </a>
            


          

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/representable/index.html">Representable</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/disposable/index.html">Disposable</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/roar/index.html">Roar</a>

        
      </div>


      
    </div>

    
  
</div>


    </nav>
    <div class="lg:p-10 pl-8 pr-4 py-10 bg-light-grey grow">
      <h1 class="lg:text-3xl text-2xl text-blue font-bold">
        <span class="py-1 px-3 border border rounded border border-white text-white bg-purple">2.1</span>
        <span class="font-black uppercase header-text">
          Rails integration
        </span>
        Documentation
      </h1>

      <div class="xl:flex xl:gap-0.5 mt-5">
        <div class="max-w-3xl lg:p-8 lg:pb-14 p-4 bg-white text-bg-blue space-y-9" id="documentation">
          <p class="">Trailblazer runs with any Ruby web framework - Rails, Hanami or Grape. Why? Because it’s a set of additional abstraction layers like forms, service objects (“operations”) or view components. Those are designed to be completely isolated and decoupled from the hosting infrastructure framework.</p>

<p class="">Nevertheless, you’re lucky if your project is using Rails since we provide convenient glue code in the <code class="text-purple">trailblazer-rails</code> gem.</p>

<pre class=""><code class="rounded">
gem "trailblazer-rails"</code></pre>

<p class="">This will automatically pull the <code class="text-purple">trailblazer</code> gem along with its commonly used dependencies. The <code class="text-purple">Trailblazer::Rails::Railtie</code> railtie will activate all necessary convenience methods for you. You don’t have to do anything manually.</p>

<div class="rounded flex p-4 gap-4 bg-bg-purple-1/50">
  <img src="/assets/info_icon-faf751d86d27155660995d9f129cfd3b63ce05a3a91e1acdda7d214f55bdb347.svg" />
  <div class="space-y-3">
    
<p class="">There’s a beautiful QUICK START tutorial introducing you to <a href="/2.1/docs/tutorials/activity.html#tutorials-quick-start-03-rails-basics" class="underline text-purple">Trailblazer in Rails</a>.</p>

  </div>
</div>

<h2 id="rails-integration-controller" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span class="header-text">Controller</span><span class="flex max-w-fit max-h-7 border border-grey uppercase text-grey text-xs pt-1 pb-1 pl-2 pr-2 pr-1 ml-4 rounded">
            <svg class="fill-grey mt-[2px]" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M168.5 72L256 165l87.5-93h-175zM383.9 99.1L311.5 176h129L383.9 99.1zm50 124.9H256 78.1L256 420.3 433.9 224zM71.5 176h129L128.1 99.1 71.5 176zm434.3 40.1l-232 256c-4.5 5-11 7.9-17.8 7.9s-13.2-2.9-17.8-7.9l-232-256c-7.7-8.5-8.3-21.2-1.5-30.4l112-152c4.5-6.1 11.7-9.8 19.3-9.8H376c7.6 0 14.8 3.6 19.3 9.8l112 152c6.8 9.2 6.1 21.9-1.5 30.4z" /></svg>
            <a href="https://github.com/trailblazer/trailblazer-rails/tree/v{version}" class="ml-1" title="This feature is implement in the trailblazer-rails gem.">trailblazer-rails </a>
          </span></h2>

<p class="">Controller extensions help with</p>

<ul class="space-y-2">
  <li class="list-image-disc ml-10">invoking operations and dealing with the outcome in controller actions.</li>
  <li class="list-image-disc ml-10">rendering cells that access variables from the operation’s result object.</li>
</ul>

<p class="">Please note, though, that we’re slowly moving towards using <a href="/2.1/docs/endpoint.html" class="underline text-purple">endpoint</a>s in controllers. Once this new layer becomes stable we will support both approaches.</p>

<h3 id="rails-integration-controller-manual-invoke" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span class="header-text">Manual invoke</span></h3>

<p class="">In order to run an operation in a controller you may simply invoke it manually.</p>

<pre class=""><code class="rounded">class SongsController &lt; ApplicationController
  def create
    result = Song::Operation::Create.(params: params) # manual invocation.
    # ...
  end
end
</code></pre>

<p class="">Note how you have to pass all data into the <code class="text-purple">#call</code>, even variables such as <code class="text-purple">params</code>, that are  “magically everywhere” in Rails. This is per design - we want encapsulation!</p>

<p class="">After running the operation, you need to handle different outcomes.</p>

<pre class=""><code class="rounded">class SongsController &lt; ApplicationController
  def create
    result = Song::Operation::Create.(params: params) # manual invocation.

    if result.success?
      redirect_to song_path(result[:model].id)
    else # failure
      @form = result[:"contract.default"]

      render
    end
  end
end
</code></pre>

<p class="">In a bit more complex situations, with more data being passed into the operation, this might become repetitive and quite complex.</p>

<p class=""><a name="trailblazer-rails-run"></a><!-- @old-link -->
<a name="trailblazer-rails-run-return-value"></a><!-- @old-link -->
<!-- http://localhost:4000/2.1/docs/rails.html#rails-support-controller-run-return-value --></p>
<h3 id="rails-integration-controller-run" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span class="header-text">Run</span></h3>

<p class="">The <code class="text-purple">trailblazer-rails</code> gem provides <code class="text-purple">#run</code> to simplify the task of invoking operations.</p>

<pre class=""><code class="rounded">def new
  ctx = run Song::Operation::New

  @form = ctx[:"contract.default"]

  render
end
</code></pre>

<p class="">The <code class="text-purple">#run</code> method will always return the result object (or ctx) from the operation.</p>

<p class="">While it invokes the specified operation it does three things for you.</p>

<ul class="space-y-2">
  <li class="list-image-disc ml-10">Without any additional configuration, <code class="text-purple">#run</code> passes the controller’s <code class="text-purple">params</code> hash into the operation call as in the example above.</li>
  <li class="list-image-disc ml-10">It automatically assigns <code class="text-purple">@model</code> and, if available, <code class="text-purple">@form</code> for you, after invoking the operation.</li>
  <li class="list-image-disc ml-10">The <code class="text-purple">ctx</code> object is assigned to <code class="text-purple">@_result</code>.</li>
</ul>

<h4 id="rails-integration-controller-run-block-syntax" class="font-bold text-neutral-500 lg:text-1xl text-xl py-2">Run
                  <span class="text-purple bg-lighter-purple p-2 rounded font-medium header-text">Block syntax</span>

                  </h4>

<p class="">To handle success and failure cases, run accepts an optional block.</p>

<pre class=""><code class="rounded">def create
  _ctx = run Song::Operation::Create do |ctx|
    # success!
    return redirect_to song_path(ctx[:model].id) # don't forget the return.
  end

  # failure
  @form = _ctx[:"contract.default"]

  render
end
</code></pre>

<p class="">The block is only run for a successful outcome of the operation - or in other words, when <code class="text-purple">ctx.success?</code> is true. Into the block is passed the result object (or <code class="text-purple">ctx</code>) as a block argument.</p>

<div class="rounded flex p-4 gap-4 bg-bg-purple-1/50">
  <img src="/assets/info_icon-faf751d86d27155660995d9f129cfd3b63ce05a3a91e1acdda7d214f55bdb347.svg" />
  <div class="space-y-3">
    
<p class="">Do not forget to use <code class="text-purple">return</code> in the block, otherwise Ruby will execute the remaining code under the block, too.</p>

  </div>
</div>

<p class="">After the block, you usually add code for handling a failing outcome of the operation run. Here, you can use the <code class="text-purple">ctx</code> object returned from <code class="text-purple">#run</code>.</p>

<h4 id="rails-integration-controller-run-keyword-arguments" class="font-bold text-neutral-500 lg:text-1xl text-xl py-2">Run
                  <span class="text-purple bg-lighter-purple p-2 rounded font-medium header-text">Keyword arguments</span>

                  </h4>

<p class="">The success block of <code class="text-purple">#run</code> can also hand you variables from <code class="text-purple">ctx</code> as keyword arguments, just as you know it from [operation steps].</p>

<pre class=""><code class="rounded">def create
  _ctx = run Song::Operation::Create do |ctx, model:,**|
    return redirect_to song_path(model.id) # see how model is available?
  end

  # failure
  @form = _ctx[:"contract.default"]

  render
end
</code></pre>

<p class="">This is convenient shortcut to access ctx variables, and gives you a runtime error should that variable be absent.</p>

<div class="rounded flex p-4 gap-4 bg-bg-purple-1/50">
  <img src="/assets/info_icon-faf751d86d27155660995d9f129cfd3b63ce05a3a91e1acdda7d214f55bdb347.svg" />
  <div class="space-y-3">
    
<p class="">Keyword arguments for <code class="text-purple">#run</code> are available from <code class="text-purple">trailblazer-rails</code> &gt;= 2.4.2.</p>

  </div>
</div>

<h4 id="rails-integration-controller-run-runtime-variables" class="font-bold text-neutral-500 lg:text-1xl text-xl py-2">Run
                  <span class="text-purple bg-lighter-purple p-2 rounded font-medium header-text">Runtime variables</span>

                  </h4>

<p class="">If your operation needs more variables in the ctx you can hand in those via <code class="text-purple">#run</code>.</p>

<pre class=""><code class="rounded">class SongsController &lt; ApplicationController
  # ...
  def create
                                      # vvvvvvvvvvvvvvvvvvvvvvvvvv
    _ctx = run Song::Operation::Create, current_user: current_user do |ctx, model:, **|
      return redirect_to song_path(model.id)
    end

    @form = _ctx[:"contract.default"]

    render
  end
end
</code></pre>

<p class="">This will add <code class="text-purple">:current_user</code> to the ctx passed into the <code class="text-purple">Song::Operation::Create</code> operation, allowing you to access it in the steps, as done in the example step below.</p>

<pre class=""><code class="rounded">
class Song::Operation::Create &lt; Trailblazer::Operation
  # ...
  step :user_allowed?

  def user_allowed?(ctx, current_user:, **)
    # do something with {current_user}
  end
end</code></pre>

<p class="">You can also configure generic <a href="#rails-support-controller-run-run-options" class="underline text-purple">variables on the controller level</a>, they will be passed to all operations of that controller.</p>

<h4 id="rails-integration-controller-run-run-options" class="font-bold text-neutral-500 lg:text-1xl text-xl py-2">Run
                  <span class="text-purple bg-lighter-purple p-2 rounded font-medium header-text">Run Options</span>

                  </h4>

<p class="">Often, several operations across an application slice have generic variables, such as the <code class="text-purple">current_user</code>. Instead of redundantly passing them to <code class="text-purple">#run</code> in every controller action, you can configuring variables on the controller-level.</p>

<p class="">Override <code class="text-purple">#_run_options</code> to do that automatically for all <code class="text-purple">run</code> calls in a controller.</p>

<pre class=""><code class="rounded">class SongsController &lt; ApplicationController
  private def _run_options(options)
    options.merge(
      current_user: current_user
    )
  end
  # ...
end
</code></pre>

<p class="">The overridden <code class="text-purple">#_run_options</code> method will result in <code class="text-purple">:current_user</code> being passed into the operation when using <code class="text-purple">#run</code> without having to specify that particular parameter.</p>

<pre class=""><code class="rounded">def create
  _ctx = run Song::Operation::Create do |ctx, model:, **|
    return redirect_to song_path(model.id)
  end

  @form = _ctx[:"contract.default"]

  render
end
</code></pre>

<p class="">When mixing both styles, options passed directly to <code class="text-purple">#run</code> will win over possible same-named options in <code class="text-purple">#_run_options</code>.</p>

<h3 id="rails-integration-controller-endpoint" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span class="header-text">Endpoint</span></h3>

<p class=""><a href="https://github.com/trailblazer/trailblazer-endpoint" class="pink"><i class="fa fa-gem" aria-hidden="true"></i> trailblazer-endpoint</a></p>

<p class="">During the past few years of Trailblazer a new layer emerged, we call it <em>endpoint</em>. An endpoint is literally an “operation” getting invoked straight from the controller and running your business operation (like <code class="text-purple">Song::Operation::Create</code>) at some point. Before and after that, you can place code steps you’d normally use in <code class="text-purple">before_filter</code> and friends.</p>

<p class="">We will document this new (completely optional!) layer once it is fully presentable. Until then, check out the <a href="/2.1/docs/endpoint.html" class="underline text-purple">API docs</a>.</p>


<h2 id="rails-integration-cells" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span class="header-text">Cells</span><span class="flex max-w-fit max-h-7 border border-grey uppercase text-grey text-xs pt-1 pb-1 pl-2 pr-2 pr-1 ml-4 rounded">
            <svg class="fill-grey mt-[2px]" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M168.5 72L256 165l87.5-93h-175zM383.9 99.1L311.5 176h129L383.9 99.1zm50 124.9H256 78.1L256 420.3 433.9 224zM71.5 176h129L128.1 99.1 71.5 176zm434.3 40.1l-232 256c-4.5 5-11 7.9-17.8 7.9s-13.2-2.9-17.8-7.9l-232-256c-7.7-8.5-8.3-21.2-1.5-30.4l112-152c4.5-6.1 11.7-9.8 19.3-9.8H376c7.6 0 14.8 3.6 19.3 9.8l112 152c6.8 9.2 6.1 21.9-1.5 30.4z" /></svg>
            <a href="https://github.com/trailblazer/trailblazer-rails/tree/v{version}" class="ml-1" title="This feature is implement in the trailblazer-rails gem.">trailblazer-rails </a>
          </span></h2>

<p class=""><a href="/2.1/docs/cells.html" class="underline text-purple">Cells</a> is a separate gem, it provides view components to maintain strong encapsulation in your partial world.</p>

<p class="">The <code class="text-purple">trailblazer-rails</code> gem makes it very simple to use the Cells gem along with TRB. It overrides <code class="text-purple">ActionController#render</code> and allows to render a cell.</p>

<h3 id="rails-integration-cells-file-structure" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span class="header-text">File structure</span></h3>

<p class="">In the early, adventurous days of Cells - the project was kicked off in 2007 - both naming of cell classes and their file structure was following the Rails Way™ style. In a Rails app, you could find a structure as below.</p>

<pre class=""><code class="rounded">
gem "cells"

app
├── cells
│   ├── song_cell.rb
│   ├── song
│   │   ├── show.erb
│   │   ├── list.erb</code></pre>

<p class="">While this is still possible by simply using the <code class="text-purple">cells</code> gem stand-alone, most projects using Trailblazer prefer the new file structure implemented in the <code class="text-purple">trailblazer-cells</code> gem.</p>

<pre class=""><code class="rounded">
gem "trailblazer-cells"

app
├── concepts
│   ├── song
│   │   ├── cell
│   │   │   ├── show.rb # Song::Cell::Show
│   │   │   ├── list.rb
│   │   ├── view
│   │   │   ├── show.erb
│   │   │   ├── list.erb</code></pre>

<p class="">This results in your cells being named <code class="text-purple">Song::Cell::Show</code>, adhering to the Trailblazer convention. Refer to the  to learn more about Trailblazer cells.</p>

<h3 id="rails-integration-cells-render" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span class="header-text">Render</span></h3>

<p class="">The <code class="text-purple">trailblazer-rails</code> gem extends the <code class="text-purple">#render</code> method and allows you to render cells in controllers and views.</p>

<pre class=""><code class="rounded">
class SongsController &lt; ApplicationController
  def create
    run Song::New # optional

    render cell(Song::Cell::New, @model)
  end
end</code></pre>

<p class="">You simply invoke <code class="text-purple">#cell</code> the way you did it before, and pass it to <code class="text-purple">render</code>. If the first argument to <code class="text-purple">#render</code> is not a cell, the original Rails <code class="text-purple">render</code> version will be used, allowing you to use serializers, partials or whatever else you need.</p>

<h4 id="rails-integration-cells-render-skip-controller-layout" class="font-bold text-neutral-500 lg:text-1xl text-xl py-2">Render
                  <span class="text-purple bg-lighter-purple p-2 rounded font-medium header-text">Skip controller layout</span>

                  </h4>

<p class="">Per default, <code class="text-purple">#render</code> will add <code class="text-purple">layout: true</code> to render the controller’s ActionView layout.</p>

<p class="">The controller’s layout can be disabled using <code class="text-purple">layout: false</code>. These are pure Rails mechanics.</p>

<pre class=""><code class="rounded">
render cell(Song::Cell::New, @model), layout: false</code></pre>

<p class="">In fact, any option passed to <code class="text-purple">render</code> will be passed through to the controller’s <code class="text-purple">#render</code>.</p>

<h4 id="rails-integration-cells-render-cell-options" class="font-bold text-neutral-500 lg:text-1xl text-xl py-2">Render
                  <span class="text-purple bg-lighter-purple p-2 rounded font-medium header-text">Cell options</span>

                  </h4>

<p class="">As you’re using <code class="text-purple">#cell</code> from the Cells gem you may pass any option the cell understands.</p>

<pre class=""><code class="rounded">
render cell(Song::Cell::New, model, layout: Song::Cell::DarkLayout)</code></pre>

<p class="">For instance, you can instruct the cell to use a separate layout cell. Note that this option is passed to <code class="text-purple">#cell</code>, not to <code class="text-purple">#render</code>.</p>

<h3 id="rails-integration-cells-configuration" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span class="header-text">Configuration</span></h3>

<p class="">You can set controller-wide options passed to every <code class="text-purple">#cell</code> call by overriding the <code class="text-purple">#options_for_cell</code> method.</p>

<pre class=""><code class="rounded">
class SongsController &lt; ApplicationController
  private def options_for_cell(model, options)
    {
      layout: Song::Cell::DarkLayout # used for all #cell calls.
    }
  end
end</code></pre>

<p class="">This is extremely helpful for providing controller-wide options like <code class="text-purple">:layout</code>, allowing you to skip this specific option in all actions.</p>

<pre class=""><code class="rounded">
class SongsController &lt; ApplicationController
  def create
    # ..
    render cell(Song::Cell::New, model) # no need to pass {layout: Song::Cell::DarkLayout}
  end</code></pre>

<div class="rounded flex p-4 gap-4 bg-bg-purple-1/50">
  <img src="/assets/info_icon-faf751d86d27155660995d9f129cfd3b63ce05a3a91e1acdda7d214f55bdb347.svg" />
  <div class="space-y-3">
    
<p class="">This feature was added in <code class="text-purple">trailblazer-rails</code> version 2.2.0.</p>

  </div>
</div>

<h2 id="rails-integration-reform" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span class="header-text">Reform</span></h2>

<p class="">Reform is a form object library that helps to move validations out of your models.</p>

<p class="">It has excellent Rails support which will soon be summarized here. Until then, you can find <a href="/2.1/docs/reform/#reform-rails" class="underline text-purple">API docs here</a>.</p>

<h2 id="rails-integration-loader" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span class="header-text">Loader</span></h2>

<p class="">The <code class="text-purple">trailblazer-loader</code> gem implements a very simple way to load all files in your <code class="text-purple">concepts</code> directory in a heuristically meaningful order. It can be used in any environment.</p>

<div class="rounded flex p-4 gap-4 bg-bg-purple-1/50">
  <img src="/assets/info_icon-faf751d86d27155660995d9f129cfd3b63ce05a3a91e1acdda7d214f55bdb347.svg" />
  <div class="space-y-3">
    
<p class="">In <code class="text-purple">trailblazer-rails</code> 2.3.0 this component has been removed in favor of Rails autoloading. You can safely skip this section!</p>

  </div>
</div>

<!-- @trailblazer-loader, <trailblazer-loader[] disable loader, file structure -->

<h3 id="rails-integration-loader-loader-with-rails" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span class="header-text">Loader with Rails</span></h3>

<p class="">The <code class="text-purple">trailblazer-loader</code> gem comes pre-bundled with <code class="text-purple">trailblazer-rails</code> for historical reasons: in the early days of Trailblazer, the conventional file name <code class="text-purple">concepts/product/operation/create.rb</code> didn’t match the short operation name, such as <code class="text-purple">Product::Create</code>.</p>

<p class="">The <code class="text-purple">trailblazer-loader</code> gem’s duty was to load all concept files without using Rails’ autoloader, overcoming the latter’s conventions.</p>

<p class="">Over the years, and with the emerge of controller helpers or our workflow engine calling operations for you, the class name of an operation more and becomes a thing not to worry about.</p>

<p class="">Many projects use Trailblazer along with the Rails naming convention now. This means you can disable the loader gem, and benefit from Rails auto-magic behavior such as faster loading in the “correct” order, reloading and all the flaws that come with this non-deterministic behavior.</p>

<p class="">As a first step, add <code class="text-purple">Operation</code> to your operation’s class name, matching the Rails naming convention.</p>

<pre class=""><code class="rounded">
# app/concepts/product/operation/create.rb

module Product::Operation
  class Create &lt; Trailblazer::Operation
    # ...
  end
end</code></pre>

<p class="">It’s a Trailblazer convention to put <code class="text-purple">[ConceptName]::Operation</code> in one line: it will force Rails to load the concept name constant, so you don’t have to reopen the class yourself.</p>

<p class="">This will result in a class name <code class="text-purple">Product::Operation::Create</code>.</p>

<p class="">Next, disable the loader gem, in <code class="text-purple">config/initializers/trailblazer.rb</code>.</p>

<pre class=""><code class="rounded">
# config/initializers/trailblazer.rb

YourApp::Application.config.trailblazer.enable_loader = false</code></pre>

<p class="">Trailblazer files will now be loaded by Rails - you need to follow the Rails autoloading file naming from here on, and things should run smoothly. A nice side-effect here is that in bigger projects (with hundreds of operations), the start-up time in development accelerates significantly.</p>

<div class="rounded flex p-4 gap-4 bg-bg-purple-1/50">
  <img src="/assets/info_icon-faf751d86d27155660995d9f129cfd3b63ce05a3a91e1acdda7d214f55bdb347.svg" />
  <div class="space-y-3">
    
<p class="">The infamous <code class="text-purple">warning: toplevel constant Cell referenced by Notification::Cell</code> warning <a href="https://blog.bigbinary.com/2017/10/18/ruby-2.5-has-removed-top-level-constant-lookup.html" class="underline text-purple">is a bug in Ruby</a>. You should upgrade to Ruby &gt;= 2.5.</p>


  </div>
</div>

        </div>

            <!-- 5.5rem is lg navbar height -->
        <div class="bg-white h-screen w-56 sticky top-[5.5rem]" id="right-toc">
          <div id="docsearch" class="flex flex-col w-[203px] pt-5"></div>

          <div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-rails-integration-controller">
  <h4 class="font-base font-bold leading-10 pl-2">
     Controller
  </h4>

  
    <a class="block px-2 leading-8" href="#rails-integration-controller-manual-invoke">Manual invoke</a>

    
  
    <a class="block px-2 leading-8" href="#rails-integration-controller-run">Run</a>

    
      <a class="block px-2 pt-[.33rem] pb-[.33rem] leading-snug text-purple pl-6" href="#rails-integration-controller-run-block-syntax">Block syntax</a>
    
      <a class="block px-2 pt-[.33rem] pb-[.33rem] leading-snug text-purple pl-6" href="#rails-integration-controller-run-keyword-arguments">Keyword arguments</a>
    
      <a class="block px-2 pt-[.33rem] pb-[.33rem] leading-snug text-purple pl-6" href="#rails-integration-controller-run-runtime-variables">Runtime variables</a>
    
      <a class="block px-2 pt-[.33rem] pb-[.33rem] leading-snug text-purple pl-6" href="#rails-integration-controller-run-run-options">Run Options</a>
    
  
    <a class="block px-2 leading-8" href="#rails-integration-controller-endpoint">Endpoint</a>

    
  
</div>


<div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-rails-integration-cells">
  <h4 class="font-base font-bold leading-10 pl-2">
     Cells
  </h4>

  
    <a class="block px-2 leading-8" href="#rails-integration-cells-file-structure">File structure</a>

    
  
    <a class="block px-2 leading-8" href="#rails-integration-cells-render">Render</a>

    
      <a class="block px-2 pt-[.33rem] pb-[.33rem] leading-snug text-purple pl-6" href="#rails-integration-cells-render-skip-controller-layout">Skip controller layout</a>
    
      <a class="block px-2 pt-[.33rem] pb-[.33rem] leading-snug text-purple pl-6" href="#rails-integration-cells-render-cell-options">Cell options</a>
    
  
    <a class="block px-2 leading-8" href="#rails-integration-cells-configuration">Configuration</a>

    
  
</div>


<div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-rails-integration-reform">
  <h4 class="font-base font-bold leading-10 pl-2">
     Reform
  </h4>

  
</div>


<div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-rails-integration-loader">
  <h4 class="font-base font-bold leading-10 pl-2">
     Loader
  </h4>

  
    <a class="block px-2 leading-8" href="#rails-integration-loader-loader-with-rails">Loader with Rails</a>

    
  
</div>


        </div>
      </div>
    </div>
  </div>
</section>


<footer class="lg:text-left bg-bg-blue py-16 text-white text-center text-base">
  <div class="lg:flex justify-between w-11/12 max-w-[80rem] mx-auto">
    <div class="lg:flex lg:flex-col lg:justify-between">
      <a href="/2.1/" class="block shrink-0 w-fit mx-auto lg:mx-0" >
        <img class="w-48" src="/assets/logo_white_ruby-01c45713d0879788514c52d65ac53e92d7735b42cec0baf6e080b08f9a0fb595.svg" />
      </a>
      <div class="lg:block hidden">
        © 2023 Trailblazer GmbH
      </div>
    </div>
    <div class="lg:flex lg:gap-20 xl:gap-40">
      <div class="lg:mt-0 flex flex-col gap-5 mt-15">
        <a class="font-bold text-xl" href="/2.1/docs/trailblazer/">Documentation</a>
        <a href="/2.1/docs/trailblazer/#trailblazer-learn-trailblazer-tales">Videos</a>
        <a href="/2.1/docs/trailblazer/">API</a>
        <a href="/2.1/docs/operation/">Operation</a>
      </div>
      <div class="lg:mt-0 flex flex-col gap-5 mt-15">
        <a class="font-bold text-xl" href="/2.1/about/">About us</a>
        <a href="https://dev.to/trailblazer">Blog</a>
        <a href="/2.1/about/">Trailblazer GmbH</a>
        <a href="/2.1/pro/">Trailblazer PRO</a>
      </div>
      <div class="lg:mt-0 flex flex-col gap-5 mt-15">
        <a class="font-bold text-xl" href="https://trailblazer.zulipchat.com">Help</a>
        <a href="https://trailblazer.zulipchat.com">Chat</a>
        <a href="http://eepurl.com/hHE3a5">Newsletter</a>
      </div>
    </div>
  </div>
  <div class="lg:hidden mt-15">
    © 2023 Trailblazer GmbH
  </div>
</footer>


  </body>
</html>
