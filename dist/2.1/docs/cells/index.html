<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
    <title>Cells - Trailblazer</title>
    <meta content="width=device-width,initial-scale=1" name="viewport"/>
    
    
    <link rel="stylesheet" href="/assets/tailwind-8f15cbd7f2c8c766d3adfa9f7e4b840e9220fb11a8435f33193f89a76b1564c2.css" />
<link rel="stylesheet" href="/assets/inter-font-8c3e82affb176f4bca9616b838d906343d1251adc8408efe02cf2b1e4fcf2bc4.css" />
    <link rel="stylesheet" href="/assets/application-e90144030d3ddedb521195c82273d47776f7f85012b6cc8d95c64466591b600f.css" />
    <script>pageIdentifier = "docs";</script>
    <script type="importmap" data-turbo-track="reload">{
  "imports": {
    "application": "/assets/application-e668100add93b10dcecaea50f9d1e2e5b6cbd64bf8d0bbd950e7f01a22373d01.js",
    "anchor-js": "/assets/anchor-js-821952d04abcd941bb3541822cd1c1f0234e5168bef1f9b2a050868af608aa5a.js",
    "navigations": "/assets/navigations-27f57ba888008b48256d2635e15bd2f0be7a039b32c8e84140da87596cbf9547.js",
    "highlight.js/lib/core": "https://ga.jspm.io/npm:highlight.js@11.8.0/es/core.js",
    "highlight.js/lib/languages/ruby": "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/es/languages/ruby.min.js",
    "jquery": "/assets/jquery-9292661fe0d8c5ef2ef35f5ca64d541d70c87e9f6d7f2716d646591a295b7f36.js",
    "jquery.parallax-scroll": "/assets/jquery.parallax-scroll-a50d2125650d18a234bc9a3eea0a0f1c40871f3ccfba877d0eae70e690955825.js"
  }
}</script>
<link rel="modulepreload" href="/assets/application-e668100add93b10dcecaea50f9d1e2e5b6cbd64bf8d0bbd950e7f01a22373d01.js">
<link rel="modulepreload" href="/assets/anchor-js-821952d04abcd941bb3541822cd1c1f0234e5168bef1f9b2a050868af608aa5a.js">
<script src="/assets/es-module-shims.min-4ca9b3dd5e434131e3bb4b0c1d7dff3bfd4035672a5086deec6f73979a49be73.js" async="async" data-turbo-track="reload"></script>
<script type="module">import "application"</script>

    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  </head>
  <body>
    <nav class=" text-base z-[50] top-0 absolute w-full lg:h-[5.5rem] lg:px-[5.6rem] py-3 lg:flex lg:justify-between lg:items-center bg-white sticky" id="navbar">
  <a href="/2.1" class="block shrink-0 w-fit mx-auto lg:mx-0">
    <img class="w-40 lg:my-0" src="/assets/logo_blue_ruby-e87334a67ff20033fae8c8d2c07e549b5f1faa9b75bb07fbb2ff9d1c0dfef6e7.svg" />
  </a>
  <div class="lg:hidden absolute right-4 top-2 flex w-9 h-9 items-center" id="hamburgerIcon">
    <div class="pointer-events-none w-full h-0.5 bg-blue transition-all duration-150
                  before:content-[''] before:absolute before:w-full before:h-0.5 before:bg-blue before:-translate-y-2.5 before:transition-all before:duration-150
                  after:content-[''] after:absolute after:w-full after:h-0.5 after:bg-blue after:translate-y-2.5 after:transition-all after:duration-150"></div>
  </div>
  <div class="lg:hidden flex flex-col text-center hidden" id="navList">
    <div class="lg:absolute flex flex-col mt-15 gap-10 uppercase">
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/docs/trailblazer">Documentation</a>
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="https://dev.to/trailblazer">Blog</a>
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/about.html">About</a>
      
      <!-- <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/pro.html">PRO</a> -->
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="https://trailblazer.zulipchat.com">Chat with us</a>
    </div>
  </div>
  <div class="lg:flex hidden gap-10 items-center">
    <div class="flex gap-7">
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold underline decoration-[5px] underline-offset-[15px] decoration-purple hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/docs/trailblazer">Documentation</a>
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="https://dev.to/trailblazer">Blog</a>
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/about.html">About</a>
      <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.0/">→ 2.0</a>
      
      <!-- <a class="font-medium text-base uppercase lg:normal-case lg:font-semibold  hover:underline hover:decoration-[5px] hover:underline-offset-[15px] hover:decoration-purple " href="/2.1/pro.html">PRO</a> -->
    </div>

    <a class="base-button text-base w-[12.5rem] h-[3.25rem] bg-light-purple text-blue hover:text-white hover:bg-purple" href="https://trailblazer.zulipchat.com">Chat with us</a>
  </div>
</nav>

<section>
  <div class="lg:hidden bg-bg-blue text-white fixed left-0 top-20 pr-1 py-3 rounded-r" id="sideNavShowButton" style="writing-mode: vertical-rl; text-orientation: upright;">
    Chapters
  </div>
  <div class="lg:flex">
    <nav class="bg-bg-blue w-screen h-screen fixed top-0 z-20 right-[100vw] overflow-y-scroll lg:w-3/12 lg:max-w-[23rem] lg:overflow-y-visible lg:shrink-0 lg:sticky lg:top-[5.5rem]" id="sideNav">
      <button class="lg:hidden absolute right-4 top-4 text-3xl text-white" id="sideNavHideButton">
        X
      </button>
      <div class="lg:pt-10 lg:pl-5 xl:pl-20 p-10 pl-20 text-white leading-10 space-y-1 h-full overflow-auto">
  


  
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/trailblazer/index.html">Trailblazer</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/operation/index.html">Operation</a>

        

          

            
              <a href="/2.1/docs/activity/deprecated/index.html" class="" title="Deprecated activity docs: :input/:output, ...">
                
                    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512" class="fill-grey pl-3 hover:fill-purple flex-inline"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M251.7 127.6l0 0c10.5 10.5 24.7 16.4 39.6 16.4H448c8.8 0 16 7.2 16 16v32H48V96c0-8.8 7.2-16 16-16H197.5c4.2 0 8.3 1.7 11.3 4.7l33.9-33.9L208.8 84.7l42.9 42.9zM48 240H464V416c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V240zM285.7 93.7L242.7 50.7c-12-12-28.3-18.7-45.3-18.7H64C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H291.3c-2.1 0-4.2-.8-5.7-2.3z"/></svg>
                 
              </a>

            


          

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/rails_integration/index.html">Rails integration</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/test/index.html">Test</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col border-t-[1px] border-t-light-purple">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/macro/index.html">Macro</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/workflow/index.html">Workflow</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/endpoint/index.html">Endpoint</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/internals/index.html">Internals</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col border-t-[1px] border-t-light-purple">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/reform/index.html">Reform</a>

        

          

            

              <a href="/2.1/docs/reform/3.0/index.html" class="">
                <span class="h-5 text-[8pt] py-[3px] px-2 rounded-[8px] ml-3 hover:bg-purple hover:border-purple hover:text-white border border-grey text-grey">
                  3.0
                </span>
              </a>
            


          

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class="bg-dark-purple flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/cells/index.html">Cells</a>

        

          

            

              <a href="/2.1/docs/cells/5.0/index.html" class="">
                <span class="h-5 text-[8pt] py-[3px] px-2 rounded-[8px] ml-3 hover:bg-purple hover:border-purple hover:text-white border border-grey text-grey">
                  5.0
                </span>
              </a>
            


          

        
      </div>


      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-cells-4-overview">
          <a href="#cells-4-overview" class="pl-8">Overview</a>
        </div>
      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-cells-4-api">
          <a href="#cells-4-api" class="pl-8">API</a>
        </div>
      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-cells-4-trailblazer">
          <a href="#cells-4-trailblazer" class="pl-8">Trailblazer</a>
        </div>
      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-cells-4-testing">
          <a href="#cells-4-testing" class="pl-8">Testing</a>
        </div>
      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-cells-4-rendering">
          <a href="#cells-4-rendering" class="pl-8">Rendering</a>
        </div>
      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-cells-4-rails">
          <a href="#cells-4-rails" class="pl-8">Rails</a>
        </div>
      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-cells-4-template-engines">
          <a href="#cells-4-template-engines" class="pl-8">Template Engines</a>
        </div>
      
        
        <!-- FIXME: link should know its IDs. -->
        <div class="flex items-center" id="left-toc-cells-4-troubleshooting">
          <a href="#cells-4-troubleshooting" class="pl-8">Troubleshooting</a>
        </div>
      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/representable/index.html">Representable</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/disposable/index.html">Disposable</a>

        
      </div>


      
    </div>

    
  
    <div class="flex flex-col ">
      <div class=" flex items-center">
        <a class="pl-4 font-bold" href="/2.1/docs/roar/index.html">Roar</a>

        
      </div>


      
    </div>

    
  
</div>


    </nav>
    <div class="lg:p-10 pl-8 pr-4 py-10 bg-light-grey grow">
      <h1 class="lg:text-3xl text-2xl text-blue font-bold">
        <span class="py-1 px-3 border border rounded border border-white text-white bg-purple">2.1</span>
        <span class="font-black uppercase">
          Cells 4
        </span>
        Documentation
      </h1>

      <div class="xl:flex xl:gap-0.5 mt-5">
        <div class="max-w-3xl lg:p-8 lg:pb-14 p-4 bg-white text-bg-blue space-y-9" id="documentation">
          <p class="">Out of the frustration with Rails’ view layer, its lack of encapsulation and the convoluted code resulting from partials and helpers both accessing global state, the <a href="https://github.com/apotonick/cells" class="underline text-purple">Cells</a> gem emerged.</p>

<p class="">The cells gem is completely stand-alone and can be used without Trailblazer.</p>

<p class="">A cell is an object that represent a fragment of your UI. The scope of that fragment is up to you: it can embrace an entire page, a single comment container in a thread or just an avatar image link.</p>

<p class="">In other words: <strong>A cell is an object that can render a template.</strong></p>

<h2 id="cells-4-overview" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span>Overview</span></h2>

<p class="">Cells are faster than ActionView. While exposing a better performance, you step-wise encapsulate fragments into cell widgets and enforce interfaces.</p>

<h3 id="cells-4-overview-view-model" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>View Model</span></h3>

<p class="">Think of cells, or <em>view models</em>, as small Rails controllers, but without any HTTP coupling. Cells embrace all presentation and rendering logic to present a fragment of the UI.</p>

<h3 id="cells-4-overview-rendering-a-cell" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Rendering a Cell</span></h3>

<p class="">Cells can be rendered anywhere in your application. Mostly, you want to use them in controller views or actions to replace a complex helper/partial mess.</p>

<pre><code>  - # app/views/comments/index.html.haml
  %h1 Comments
  @comments.each do |comment|
    = concept("comment/cell", comment) #=&gt; Comment::Cell.new(comment).show
</code></pre>

<p class="">This will instantiate and invoke the <code class="text-purple">Comment::Cell</code> for each comment. It is completely up to the cell how to return the necessary markup.</p>

<h3 id="cells-4-overview-cell-class" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Cell Class</span></h3>

<p class="">Following the Trailblazer convention, the <code class="text-purple">Comment::Cell</code> sits in <code class="text-purple">app/concepts/comment/cell.rb</code>.</p>

<pre><code>  class Comment::Cell &lt; Cell::ViewModel
    def show
      "This: #{model.inspect}"
    end
  end
</code></pre>

<p class="">Per default, the <code class="text-purple">#show</code> method of a cell is called when it is invoked from a view. This method is responsible to compile the HTML (or whatever else you want to present) that is returned and displayed.</p>

<p class="">Whatever you pass into the cell via the <code class="text-purple">concept</code> helper will be available as the cell’s <code class="text-purple">#model</code>.
Whatever you return from the <code class="text-purple">show</code> method will be displayed in the page invoking the cell.</p>

<pre><code>  = concept("comment/cell", comment) #=&gt; "This: &lt;Comment body=\"MVC!\"&gt;"
</code></pre>

<p class="">Note that you can pass anything into a cell. This can be an ActiveRecord model, a PORO or an array of attachments. The cell provides access to it via <code class="text-purple">model</code> and it’s your job do use it correctly.</p>

<h3 id="cells-4-overview-cell-views" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Cell Views</span></h3>

<p class="">While we already have a cleaner interface as compared to helpers accessing to global state, the real power of Cells comes when rendering views. This, again, is similar to controllers.</p>

<pre><code>  class Comment::Cell &lt; Cell::ViewModel
    def show
      render # renders app/concepts/comment/views/show.haml
    end
  end
</code></pre>

<p class="">Using <code class="text-purple">#render</code> without any arguments will parse and interpolate the <code class="text-purple">app/concepts/comment/views/show.haml</code> template. Note that you’re free to use <a href="https://github.com/trailblazer/cells-erb" class="underline text-purple">ERB</a>, <a href="https://github.com/trailblazer/cells-haml" class="underline text-purple">Haml</a>, or <a href="https://github.com/trailblazer/cells-slim" class="underline text-purple">Slim</a>.</p>

<pre><code>  - # app/concepts/comment/views/show.haml
  %li
    = model.body
    By
    = link_to model.author.email, author_path(model.author)
</code></pre>

<p class="">That’s right, you can use Rails helpers in cell views.</p>

<h3 id="cells-4-overview-no-helpers" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>No Helpers</span></h3>

<p class="">While you could reference <code class="text-purple">model</code> throughout your view and strongly couple view and model, Cells makes it extremely simple to have logicless views and move presentation code to the cell instance itself.</p>

<pre><code>  - # app/concepts/comment/views/show.haml
  %li
    = body
    By #{author_link}
</code></pre>

<p class="">Every method invoked in the view is called on the cell instance. This means we have to implement <code class="text-purple">#body</code> and <code class="text-purple">#author_link</code> in the cell class. Note that how that completely replaces helpers with clean object-oriented methods.</p>

<pre><code>  class Comment::Cell &lt; Cell::ViewModel
    def show
      render
    end

  private
    def body
      model.body
    end

    def author_link
      link_to model.author.email, author_path(model.author)
    end
  end
</code></pre>

<p class="">What were global helper functions are now instance methods. All Rails helpers like <code class="text-purple">link_to</code> are available on the cell instance.</p>

<h3 id="cells-4-overview-properties" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Properties</span></h3>

<p class="">Delegating attributes to the model is so common it is built into Cells.</p>

<pre><code>  class Comment::Cell &lt; Cell::ViewModel
    property :body
    property :author

    def show
      render
    end

  private
    def author_link
      link_to author.email, author_path(author)
    end
  end
</code></pre>

<p class="">The <code class="text-purple">::property</code> declaration will create a delegating method for you.</p>

<h3 id="cells-4-overview-testing" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Testing</span></h3>

<p class="">The best part about Cells is: you can test them in isolation. If they work in a test, they will work just anywhere.</p>

<pre><code>  describe Comment::Cell do
    it do
      html = concept("comment/cell", Comment.find(1)).()
      expect(html).to have_css("h1")
    end
  end
</code></pre>

<p class="">The <code class="text-purple">concept</code> helper will behave exactly like in a controller or view and allows you to write rock-solid test for view components with a very simple API.</p>

<h3 id="cells-4-overview-more" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>More</span></h3>

<p class="">Cells comes with a bunch of helpful features like nesting, caching, view inheritance, and more.</p>


<p class="">The following happens now.</p>

<ol>
  <li class="list-image-disc ml-10">First, <code class="text-purple">Comment::Cell::Show</code> cell is rendered.</li>
  <li class="list-image-disc ml-10">Then, <code class="text-purple">Pro::Cell::Layout</code> is invoked and it will yield the content from the show cell.</li>
  <li class="list-image-disc ml-10">In the <code class="text-purple">layout.haml</code> view, the navigation cell is also rendered. This cell needs a <code class="text-purple">current_user</code> option which is provided by the <em>context object</em>.</li>
</ol>

<h3 id="cells-4-overview-context-object" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Context Object</span></h3>

<p class="">When rendering a hierarchy of cells, it’s often necessary to share generic data across all involved cells. This always happens via dependency injection, no global state is allowed in Trailblazer.</p>

<p class="">The <code class="text-purple">:context</code> option will create such an object and is automatically being passed to all cells in that render workflow.</p>

<p class="">In order to access the <code class="text-purple">current_user</code> from the context object, the navigation cell has to be changed slightly.</p>

<pre><code>module Pro
  module Cell
    class Navigation &lt; Trailblazer::Cell
      include ::Cell::Hamlit

      def signed_in?
        context[:current_user]
      end

      def email
        context[:current_user].email
      end

      def avatar_url
         hexed = Digest::MD5.hexdigest(email)
        "https://www.gravatar.com/avatar/#{hexed}?s=36"
      end
    end
  end
end
</code></pre>

<p class="">Note that <code class="text-purple">:current_user</code> is not an option anymore, but comes from the <code class="text-purple">context</code> object.</p>

<h3 id="cells-4-overview-success" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Success</span></h3>

<p class="">As demonstrated in this guide, it’s not really hard to replace the existing rendering stack, whether that’s <code class="text-purple">ActionView</code> or <code class="text-purple">Hanami::View</code> or Sinatra templates, with Cells.</p>

<h2 id="cells-4-api" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span>API</span></h2>

<p class="">A cell is an object that can render views. It represents a fragment of the page, or the entire page.</p>

<p class="">Sometimes they’re also called <em>object-oriented partials</em>.</p>

<p class="">The object has to define at least one method which in turn has to return the fragment. Per convention, this is <code class="text-purple">#show</code>. In this public method, you may compile arbitrary strings or <code class="text-purple">render</code> a cell view.</p>

<p class="">The return value of this public method (also called <em>state</em>) is what will be the rendered in the view using the cell.</p>

<h3 id="cells-4-api-anatomy" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Anatomy</span></h3>

<p class="">Cells usually inherit from <code class="text-purple">Cell::ViewModel</code>.</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
  def show
    render # renders app/cells/comment/show.haml
  end
end
</code></pre>

<p class="">When the <code class="text-purple">CommentCell</code> cell is invoked, its <code class="text-purple">show</code> method is called, the view is rendered, and returned as a HTML string.</p>

<p class="">This snippet illustrates a <em>suffix cell</em>, because it follows the outdated Rails-style naming and file structure. We encourage you to use <a href="#cells-trailblazer" class="underline text-purple">Trailblazer cells</a>. However, this document mostly describes the generic API.</p>

<h3 id="cells-4-api-show" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Show</span></h3>

<p class="">As per convention, <code class="text-purple">#show</code> is the only public method of a cell class.</p>

<p class="">The return value of this method is what gets rendered as the cell.</p>

<pre><code>def show
  "I don't like templates!"
end
</code></pre>

<p class="">You’re free to return whatever string you desire, use your own rendering engine, or use cells’ <code class="text-purple">render</code> for templates.</p>

<h2 id="manual-invocation">Manual Invocation</h2>

<p class="">In its purest form, a cell can be rendered as follows.</p>

<pre><code>Comment::Cell.new(comment).() #=&gt; "I don't like templates!"
</code></pre>

<p class="">This can be split up into two steps: initialization and invocation.</p>

<h3 id="cells-4-api-initialize" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Initialize</span></h3>

<p class="">You may instantiate cells manually, wherever you want.</p>

<pre><code>cell = Comment::Cell.new(comment)
</code></pre>

<p class="">This is helpful in environments where the helpers are not available, e.g. a Rails mailer or a <code class="text-purple">Lotus::Action</code>.</p>

<p class="">Note that usually you pass in an arbitrary object into the cell, the <em>“model”</em>. Here, this is the <code class="text-purple">comment</code> instance.</p>

<h3 id="cells-4-api-model" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Model</span></h3>

<p class="">The model you pass into the cell’s constructor is completely up to you! It could be an ActiveRecord instance, a <code class="text-purple">Struct</code>, or an array of items.</p>

<p class="">The model is available via the <code class="text-purple">model</code> reader.</p>

<pre><code>def show
  model.rude? ? "Offensive content." : render
end
</code></pre>

<p class="">The term <em>model</em> is really not to be confused with the way Rails uses it - it can be just anything.</p>

<h3 id="cells-4-api-property" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Property</span></h3>

<p class="">Cells allow a short form to access model’s attributes using the <code class="text-purple">property</code> class method.</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
  property :email #=&gt; model.email

  def show
    model.email #=&gt; "s@trb.to"
    email #=&gt; "s@trb.to"
  end
end
</code></pre>

<p class="">Using <code class="text-purple">::property</code> will create a convenient reader method for you to the model.</p>

<h3 id="cells-4-api-options" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Options</span></h3>

<p class="">Along with the model, you may also pass arbitrary options into the cell, for example the current user.</p>

<pre><code>cell = Comment::Cell.new(comment, current_user: current_user)
</code></pre>

<p class="">In the cell, you can access any options using  the <code class="text-purple">options</code> reader.</p>

<pre><code>def show
  options[:current_user] ? render : "Not logged in!"
end
</code></pre>

<h3 id="cells-4-api-invocation" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Invocation</span></h3>

<p class="">Once you’ve got the cell instance, you may call the rendering state. This happens via <code class="text-purple">ViewModel#call</code>.</p>

<pre><code>cell.call(:show)
</code></pre>

<p class="">It’s a common idiom in Ruby to skip the explicit <code class="text-purple">call</code> method name. The next snippet does the same as the above.</p>

<pre><code>cell.(:show)
</code></pre>

<p class="">Since <code class="text-purple">show</code> is the default state, you may simple <em>call</em> the cell without arguments.</p>

<pre><code>cell.() #=&gt; cell.(:show)
</code></pre>

<p class="">Note that in Rails controller views, this will be called automatically via cell’s <code class="text-purple">ViewModel#to_s</code> method.</p>

<h3 id="cells-4-api-call" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Call</span></h3>

<p class="">Always invoke cell methods via <code class="text-purple">call</code>. This will ensure that caching - if configured - is performed properly.</p>

<pre><code>CommentCell.new(comment).(:show)
</code></pre>

<p class="">As discussed, this will call the cell’s <code class="text-purple">show</code> method and return the rendered fragment.</p>

<p class="">Note that you can invoke more than one state on a cell, if desired.</p>

<pre><code>- cell = CommentCell.new(Comment.last)      # instantiate.
= cell.call(:show)                          # render main fragment.
= content_for :footer, cell.(:footer)       # render footer.
</code></pre>

<p class="">See how you can combine cells with global helpers like <code class="text-purple">content_for</code>?</p>

<p class="">You can also provide additional arguments to <code class="text-purple">call</code>.</p>

<pre><code>cell.(:show, Time.now)
</code></pre>

<p class="">All arguments after the method name are passed to the invoked method.</p>

<pre><code>def show(time)
  time #=&gt; Now!
end
</code></pre>

<p class="">Even blocks are allowed.</p>

<pre><code>cell.(:show) { "Yay!" }
</code></pre>

<p class="">Again, the block is passed through to the invoked method.</p>

<pre><code>def show(&amp;block)
  yield #=&gt; "Yay!"
end
</code></pre>

<p class="">This is particularly interesting when passing the block to <code class="text-purple">render</code> and using <code class="text-purple">yield</code> in the view. See <a href="#cells-api-render" class="underline text-purple">render</a>’s docs for that.</p>

<h3 id="cells-4-api-default-show" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Default Show</span></h3>

<p class="">Per default, every cell derived from <code class="text-purple">Cell::ViewModel</code> has a built-in <code class="text-purple">show</code> method.</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
  # #show is inherited.
end
</code></pre>

<p class="">The implementation looks as follows.</p>

<pre><code>def show(&amp;block)
  render &amp;block
end
</code></pre>

<p class="">An optional block is always passed to the <code class="text-purple">render</code> method.</p>

<p class="">Of course, you’re free to override <code class="text-purple">show</code> to do whatever it needs to do.</p>

<h3 id="cells-4-api-instantiation-helper" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Instantiation Helper</span></h3>

<p class="">In most environments you will instantiate cells with the <code class="text-purple">concept</code> or <code class="text-purple">cell</code> helper which internally does exactly the same as the manual invocation.</p>

<pre><code>cell = cell(:comment, comment)
</code></pre>

<p class="">This is identical to</p>

<pre><code>cell = CommentCell.new(comment)
</code></pre>

<p class="">Depending on your environment, the <code class="text-purple">cell</code> helper might inject dependencies into the created cell. For example, in Rails, the controller is passed on into the cell behind the scenes. When manually instantiating cells, you must not forget to do so, too.</p>

<p class="">The <code class="text-purple">cell</code> helper also allows passing in the cell constant. This means, it won’t try to infer the class constant name.</p>

<pre><code>cell = cell(CommentCell, comment)
</code></pre>

<h3 id="cells-4-api-file-structure" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>File Structure</span></h3>

<p class="">Having a cell to represent a fragment of your page is one thing. The real power, whatsoever, comes when rendering templates in cells. The <code class="text-purple">render</code> method does just that.</p>

<p class="">In a suffix environment, Cells expects the following file layout.</p>

<pre><code>├── app
│   ├── cells
│   │   └── comment_cell.rb
│   │   └── comment
│   │       └── show.haml
</code></pre>

<p class="">Every cell - unless configured otherwise - has its own view  directory named after the cell’s name (<code class="text-purple">comment</code>). Views do only have one extension to identify the template’s format (<code class="text-purple">show.haml</code>). Again, you’re free to provide arbitrary additional extensions.</p>

<p class="">Note that the <em>suffix</em> style shown above is deprecated, and will be superseded in Cells 5 by the <a href="#cells-trailblazer" class="underline text-purple">Trailblazer</a>-style naming and file structure.</p>

<h3 id="cells-4-api-render" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Render</span></h3>

<pre><code>class CommentCell &lt; Cell::ViewModel
  def show
    render # renders show.haml.
  end
end
</code></pre>

<p class="">A simple <code class="text-purple">render</code> will implicitly figure out the method (or state) name and attempt to render that view. Here, the file will be resolved to <code class="text-purple">app/cells/comment/show.haml</code>.</p>

<p class="">Note that <code class="text-purple">render</code> literally renders the template and returns the HTML string. This allows you to call render multiple times, concatenate, and so on.</p>

<pre><code>def show
  render + render(:footer) + "&lt;hr/&gt;"
end
</code></pre>

<p class="">You can provide an explicit view name as the first argument.</p>

<pre><code>def show
  render :item # renders item.haml
end
</code></pre>

<p class="">When providing more than one argument to <code class="text-purple">render</code>, you have to use the <code class="text-purple">:view</code> option.</p>

<pre><code>def show
  render view: :item # renders item.haml
end
</code></pre>

<p class="">If you like the clunky Rails-style file naming, you’re free to add a format to the view.</p>

<pre><code>render "shot.html" # renders show.html.haml
</code></pre>

<p class="">You can pass locals to the view using <code class="text-purple">:locals</code>.</p>

<pre><code>render locals: { logged_in: options[:current_user] }
</code></pre>

<h3 id="cells-4-api-instance-methods" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Instance Methods</span></h3>

<p class="">While it is fine to use locals or instance variables in the view to access data, the preferred way is invoking instance methods in the view.</p>

<pre><code>%h1 Show comment

= body
= author_link
</code></pre>

<p class="">Every method call in the view is dispatched to the cell instance. You have to define your “helpers” there.</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
  property :body # creates #body reader.

  def author_link
    url_for model.author.name, model.author
  end
end
</code></pre>

<p class="">This allows slim, logic-less views.</p>

<p class="">Note that you can use Rails in the instance level, too, if you’re in a Rails environment.</p>

<h3 id="cells-4-api-yield" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Yield</span></h3>

<p class="">A block passed to the cell constructor is passed on to the state method.</p>

<pre><code>CommentCell.new(comment) { "Yay!" }
cell(:comment, comment)  { "Yay!" }
</code></pre>

<p class="">It’s up to you if you want to use this block, or provide your own.</p>

<pre><code>def show(&amp;block)
  render(&amp;block)
end
</code></pre>

<p class="">Passing the block <code class="text-purple">render</code> allows yielding it in the view.</p>

<pre><code>%h1 Comment

= yield
</code></pre>

<h3 id="cells-4-api-collection" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Collection</span></h3>

<p class="">Instead of manually iterating an array of models and concatenating the output of the item cell, you can use the <code class="text-purple">:collection</code> feature.</p>

<pre><code>cell(:comment, collection: Comment.all).()
</code></pre>

<p class="">This will instantiate a cell per iterated model, invoke <code class="text-purple">call</code> and join the output into one fragment.</p>

<p class="">Pass the method name to <code class="text-purple">call</code> when you want to invoke a state different to <code class="text-purple">show</code>.</p>

<pre><code>cell(:comment, collection: Comment.all).(:item)
</code></pre>

<p class="">You’re free to pass additional options to the call.</p>

<pre><code>cell(:comment, collection: comments, size: comments.size).()
</code></pre>

<p class="">This instantiates each collection cell as follows.</p>

<pre><code>CommentCell.new(comment, size: 9)
</code></pre>

<p class="">You can use the <code class="text-purple">join</code> method to customize how each item in the collection is invoked. The return value of the block is automatically inserted in between each rendered item in the collection0</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
  def odd
    "odd comment\n"
  end

  def even
    "even comment\n"
  end
end

cell(:comment, collection: Comment.all).join do |cell, i|
  i.odd? ? cell.(:odd) : cell(:even)
end
# =&gt; "odd comment\neven comment\nodd comment\neven comment"
</code></pre>

<p class="">An optional separator string can be passed to <code class="text-purple">join</code> when it concatenates the item fragments.</p>

<pre><code>cell(:comment, collection: Comment.all).join("&lt;hr/&gt;") do |cell, i|
  i.odd? ? cell.(:odd) : cell(:even)
end
# =&gt; "odd comment\n&lt;hr/&gt;even comment\n&lt;hr/&gt;odd comment\n&lt;hr/&gt;even comment"
</code></pre>

<p class="">Alternatively, if you just want to add some extra content in between each rendered item and don’t need to customize how each item is invokved, you can call <code class="text-purple">join</code> with a separator and no block:</p>

<pre><code>class PostCell
  def show
    'My post'
  end
end

cell(:post, collection: Post.all).join("&lt;hr/&gt;")
# =&gt; "My post&lt;hr/&gt;My post&lt;hr/&gt;My post"
</code></pre>

<h3 id="cells-4-api-external-layout" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>External Layout</span></h3>

<p class="">Since Cells 4.1, you can instruct your cell to use a second cell as a wrapper. This will first render your actual content cell, then pass the content via a block to the layout cell.</p>

<p class="">Cells desiring to be wrapped in a layout have to include <code class="text-purple">Layout::External</code>.</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
  include Layout::External
end
</code></pre>

<p class="">The layout cell usually can be an empty subclass.</p>

<pre><code>class LayoutCell &lt; Cell::ViewModel
end
</code></pre>

<p class="">Its <code class="text-purple">show</code> view must contain a <code class="text-purple">yield</code> to insert the content.</p>

<pre><code>!!!
%html
  %head
    %title= "Gemgem"
    = stylesheet_link_tag 'application', media: 'all'
    = javascript_include_tag 'application'
  %body
    = yield
</code></pre>

<p class="">The layout cell class is then injected into the actual invocation using <code class="text-purple">:layout</code>.</p>

<pre><code>cell(:comment, comment, layout: LayoutCell)
</code></pre>

<p class="">The context object will automatically be passed to the layout cell.</p>

<p class="">Note that <code class="text-purple">:layout</code> also works in combination with <code class="text-purple">:collection</code>.</p>

<h3 id="cells-4-api-view-paths" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>View Paths</span></h3>

<p class="">Per default, the cell’s view path is set to <code class="text-purple">app/cells</code>. You can set any number of view paths for the template file lookup.</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
  self.view_paths = ["app/views"]
</code></pre>

<p class="">Note that the default view paths are different if you’re using the <a href="#cells-trailblazer" class="underline text-purple">Trailblazer-style file structure</a>.</p>

<h3 id="cells-4-api-template-formats" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Template Formats</span></h3>

<p class="">Cells provides support for a handful of popular template formats like ERB, Haml, etc.</p>

<p class="">You need to add the specific template engine to your Gemfile:</p>

<ul class="space-y-2">
  <li class="list-image-disc ml-10"><a href="https://github.com/trailblazer/cells-erb" class="underline text-purple">cells-erb</a></li>
  <li class="list-image-disc ml-10"><a href="https://github.com/trailblazer/cells-hamlit" class="underline text-purple">cells-hamlit</a> We strongly recommend using <a href="https://github.com/k0kubun/hamlit" class="underline text-purple">Hamlit</a> as a Haml replacement.</li>
  <li class="list-image-disc ml-10"><a href="https://github.com/trailblazer/cells-slim" class="underline text-purple">cells-slim</a></li>
  <li class="list-image-disc ml-10"><a href="https://github.com/trailblazer/cells-haml" class="underline text-purple">cells-haml</a> Make sure to bundle Haml 4.1.</li>
</ul>

<pre><code class="language-ruby">gem "haml", github: "haml/haml", ref: "7c7c169".
# Use `cells-hamlit` instead.
</code></pre>

<p class="">In Rails, this is all you need to do. In other environments, you need to include the respective module into your cells.</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
  include ::Cell::Erb # or Cell::Hamlit, or Cell::Haml, or Cell::Slim
end
</code></pre>

<h3 id="cells-4-api-html-escaping" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>HTML Escaping</span></h3>

<p class="">Cells per default does no HTML escaping, anywhere. This is one of the reasons why Cells is much faster than Rails’ ActionView.</p>

<p class="">Include <code class="text-purple">Escaped</code> to make property readers return escaped strings.</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
  include Escaped
  property :title
end

song.title                 #=&gt; "&lt;script&gt;Dangerous&lt;/script&gt;"
Comment::Cell.(song).title #=&gt; &amp;lt;script&amp;gt;Dangerous&amp;lt;/script&amp;gt;
</code></pre>

<p class="">Only strings will be escaped via the property reader.</p>

<p class="">You can suppress escaping manually.</p>

<pre><code>def raw_title
  "#{title(escape: false)} on the edge!"
end
</code></pre>

<p class="">Of course this works in views too:</p>

<pre><code>&lt;%= title(escape: false) %&gt;
</code></pre>

<h3 id="cells-4-api-context-object" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Context Object</span></h3>

<p class="">By default, every cell contains a context object. When <a href="#cells-api-nesting" class="underline text-purple">nesting cells</a>, this object gets passed in automatically. To add objects to the context, use the <code class="text-purple">:context</code> option.</p>

<pre><code>cell("comment", comment, context: { user: current_user })
</code></pre>

<p class="">You can read from the context object via the <code class="text-purple">context</code> method.</p>

<pre><code>def show
  context[:user] #=&gt; &lt;User ..&gt;
  # ..
end
</code></pre>

<p class="">The context object is handy when dependencies need to be passed down (or up, when using layouts) a cell hierarchy.</p>

<p class="">Note that the context object gets <code class="text-purple">dup</code>ed when adding to it into nested cells. This is to prevent leaking nested state back into parent objects.</p>

<h3 id="cells-4-api-nesting" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Nesting</span></h3>

<p class="">You can invoke cells in cells. This happens with the <code class="text-purple">cell</code> helper.</p>

<pre><code>def show
  html = cell(:comment_detail, model)
  # ..
end
</code></pre>

<p class="">The <code class="text-purple">cell</code> helper will automatically pass the context object to the nested cell.</p>

<h3 id="cells-4-api-view-inheritance" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>View Inheritance</span></h3>

<p class="">Cells can inherit code from each other through Ruby’s regular inheritance mechanisms.</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
end

class PostCell &lt; CommentCell
end
</code></pre>

<p class="">Even cooler, <code class="text-purple">PostCell</code> will now inherit views from <code class="text-purple">CommentCell</code>.</p>

<pre><code>PostCell.prefixes #=&gt; ["app/cells/post", "app/cells/comment"]
</code></pre>

<p class="">When views can’t be found in the local <code class="text-purple">post</code> directory, they will be looked up in <code class="text-purple">comment</code>. This starts to become helpful when using <a href="#cells-api-nesting" class="underline text-purple">composed cells</a>.</p>

<p class="">If you only want to inherit views, not the entire class, use <code class="text-purple">::inherit_views</code>.</p>

<pre><code>class PostCell &lt; Cell::ViewModel
  inherit_views Comment::Cell
end

PostCell.prefixes #=&gt; ["app/cells/post", "app/cells/comment"]
</code></pre>

<h3 id="cells-4-api-builder" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Builder</span></h3>

<p class="">Often, it’s good practice to replace decider code from views or classes by extracting it out into separate sub-cells. Or in case you want to render a polymorphic collection, builders come in handy.</p>

<p class="">Builders allow instantiating different cell classes for different models and options.</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
  include ::Cell::Builder

  builds do |model, options|
    if model.is_a?(Post)
      PostCell
    elsif model.is_a?(Comment)
      CommentCell
    end
  end
end
</code></pre>

<p class="">The <code class="text-purple">#cell</code> helper takes care of instantiating the right cell class for you.</p>

<pre><code>cell(:comment, Post.find(1)) #=&gt; creates a PostCell. This also works with collections.

cell(:comment, collection: [@post, @comment]) #=&gt; renders PostCell, then CommentCell.
</code></pre>

<p class="">Multiple calls to <code class="text-purple">::builds</code> will be ORed. If no block returns a class, the original class will be used (<code class="text-purple">CommentCell</code>). Builders are inherited.</p>

<h3 id="cells-4-api-caching" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Caching</span></h3>

<p class="">Cells allow you to cache per state. It’s simple: the rendered result of a state method is cached and expired as you configure it.</p>

<p class="">To cache forever, don’t configure anything</p>

<pre><code>class CartCell &lt; Cell::Rails
  cache :show

  def show
    render
  end
</code></pre>

<p class="">This will run <code class="text-purple">#show</code> only once, after that the rendered view comes from the cache.</p>

<h3 id="cells-4-api-cache-options" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Cache Options</span></h3>

<p class="">Note that you can pass arbitrary options through to your cache store. Symbols are evaluated as instance methods, callable objects (e.g. lambdas) are evaluated in the cell instance context allowing you to call instance methods and access instance variables. All arguments passed to your state (e.g. via <code class="text-purple">render_cell</code>) are propagated to the block.</p>

<pre><code>cache :show, :expires_in =&gt; 10.minutes
</code></pre>

<p class="">If you need dynamic options evaluated at render-time, use a lambda.</p>

<pre><code>cache :show, :tags =&gt; lambda { |*args| tags }
</code></pre>

<p class="">If you don’t like blocks, use instance methods instead.</p>

<pre><code>class CartCell &lt; Cell::Rails
  cache :show, :tags =&gt; :cache_tags

  def cache_tags(*args)
    # do your magic..
  end
</code></pre>

<h3 id="cells-4-api-conditional-caching" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Conditional Caching</span></h3>

<p class="">The <code class="text-purple">:if</code> option lets you define a condition. If it doesn’t return a true value, caching for that state is skipped.</p>

<pre><code>cache :show, :if =&gt; lambda { |*| has_changed? }
</code></pre>

<h3 id="cells-4-api-cache-keys" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Cache Keys</span></h3>

<p class="">You can expand the state’s cache key by appending a versioner block to the <code class="text-purple">::cache</code> call. This way you can expire state caches yourself.</p>

<pre><code>class CartCell &lt; Cell::Rails
  cache :show do
    order.id
  end
</code></pre>

<p class="">The versioner block is executed in the cell instance context, allowing you to access all stakeholder objects you need to compute a cache key. The return value is appended to the state key: <code class="text-purple">"cells/cart/show/1"</code>.</p>

<p class="">As everywhere in Rails, you can also return an array.</p>

<pre><code>class CartCell &lt; Cell::Rails
  cache :show do
    [id, options[:items].md5]
  end
</code></pre>

<p class="">Resulting in: <code class="text-purple">"cells/cart/show/1/0ecb1360644ce665a4ef"</code>.</p>

<h3 id="cells-4-api-debugging-cache" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Debugging Cache</span></h3>

<p class="">When caching is turned on, you might wanna see notifications. Just like a controller, Cells gives you the following notifications.</p>

<ul class="space-y-2">
  <li class="list-image-disc ml-10"><code class="text-purple">write_fragment.action_controller</code> for cache miss.</li>
  <li class="list-image-disc ml-10"><code class="text-purple">read_fragment.action_controller</code> for cache hits.</li>
</ul>

<p class="">To activate notifications, include the <code class="text-purple">Notifications</code> module in your cell.</p>

<pre><code>class Comment::Cell &lt; Cell::Rails
  include Cell::Caching::Notifications
</code></pre>

<h3 id="cells-4-api-cache-inheritance" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Cache Inheritance</span></h3>

<p class="">Cache configuration is inherited to derived cells.</p>

<h3 id="cells-4-api-testing-caching" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Testing Caching</span></h3>

<p class="">If you want to test it in <code class="text-purple">development</code>, you need to update <code class="text-purple">development.rb</code> to see the effect.</p>

<pre><code class="language-ruby">config.action_controller.perform_caching = true
</code></pre>

<h2 id="cells-4-trailblazer" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span>Trailblazer</span></h2>

<p class="">This documents the Trailblazer-style cells semantics, brought to you by the <a href="https://github.com/trailblazer/trailblazer-cells" class="underline text-purple">trailblazer-cells</a> gem.</p>

<div class="rounded flex p-4 gap-4 bg-bg-purple-1/50">
  <img src="/assets/info_icon-faf751d86d27155660995d9f129cfd3b63ce05a3a91e1acdda7d214f55bdb347.svg" />
  <div class="space-y-3">
    
<p class="">This gem can be used <strong>stand-alone</strong> without Trailblazer, its only dependency is the <code class="text-purple">cells</code> gem.</p>

  </div>
</div>

<p class="">A <code class="text-purple">Trailblazer::Cell</code> is a normal cell with Trailblazer semantics added. Naming, file structure, and the way views are resolved follow the TRB style. Note that this will be the standard for Cells 5, which will drop all old “dialects”.</p>

<h3 id="cells-4-trailblazer-installation" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Installation</span></h3>

<pre><code>gem "trailblazer-cells"
gem "cells-slim"
</code></pre>

<p class="">Make sure you also add the view engine. We recommend <a href="https://github.com/trailblazer/cells-slim" class="underline text-purple"><code class="text-purple">cells-slim</code></a>.</p>

<h3 id="cells-4-trailblazer-file-structure" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>File Structure</span></h3>

<p class="">In Trailblazer, cell classes sit in their concept’s <code class="text-purple">cell</code> directory, the corresponding views sit in the <code class="text-purple">view</code> directory.</p>

<pre><code>├── app
│   ├── concepts
│   │   └── comment            # namespace/class
│   │       ├── cell           # namespace/module
│   │       │   ├── index.rb   # class
│   │       │   ├── new.rb     # class
│   │       │   └── show.rb    # class
│   │       └── view
│   │           ├── index.slim
│   │           ├── item.slim
│   │           ├── new.slim
│   │           ├── show.slim
│   │           └── user.scss
</code></pre>

<p class="">Note that one cell class can have multiple views, as well as other assets like <code class="text-purple">.scss</code> stylesheets.</p>

<p class="">Also, the view names with <code class="text-purple">Trailblazer::Cell</code> are <em>not</em> called <code class="text-purple">show.slim</code>, but named after its corresponding cell class. For instance, <code class="text-purple">Comment::Cell::Index</code> will render <code class="text-purple">comment/view/index.slim</code>.</p>

<h3 id="cells-4-trailblazer-naming" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Naming</span></h3>

<p class="">As always, the Trailblazer naming applies.</p>

<pre><code>Comment[::SubConcepts]::Cell::[Name]
</code></pre>

<p class="">This results in classes such as follows.</p>

<pre><code>module Comment::Cell            # namespace
  class New &lt; Trailblazer::Cell # class
    def show
      render # renders app/concepts/comment/view/new.slim.
    end
  end
end
</code></pre>

<p class="">This is different to old suffix-cells. While the <code class="text-purple">show</code> method still is the public method, calling <code class="text-purple">render</code> will use the <code class="text-purple">new.slim</code> view, as inferred from the cell’s last class constant segment (<code class="text-purple">New</code>).</p>

<h3 id="cells-4-trailblazer-default-show" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Default Show</span></h3>

<p class="">Note that you don’t have to provide a <code class="text-purple">show</code> method, it is created automatically.</p>

<pre><code>module Comment::Cell
  class New &lt; Trailblazer::Cell
  end
end
</code></pre>

<p class="">This is the <strong>recommended way</strong> since no setup code should be necessary.</p>

<p class="">You’re free to override <code class="text-purple">show</code>, though.</p>

<h3 id="cells-4-trailblazer-view-names" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>View Names</span></h3>

<p class="">Per default, the view name is computed from the cell’s class name.</p>

<pre><code>Comment::Cell::New         #=&gt; "comment/view/new.slim"
Comment::Cell::Themed::New #=&gt; "comment/view/themed/new.slim"
</code></pre>

<p class="">Note that the entire path after <code class="text-purple">Cell::</code> is considered, resulting in a hierarchical view name.</p>

<p class="">Use <code class="text-purple">ViewName::Flat</code> if you prefer a flat view name.</p>

<pre><code>module Comment
  module Cell
    module Themed
      class New &lt; Trailblazer::Cell
        extend ViewName::Flat
      end
    end
  end
end

Comment::Cell::Themed::New #=&gt; "comment/view/new.slim"
</code></pre>

<p class="">This will always result in a flat name where the view name is inferred from the last segment of the cell constant.</p>

<h3 id="cells-4-trailblazer-invocation" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Invocation</span></h3>

<p class="">To render a cell in controllers, views, or other cells, use <code class="text-purple">cell</code>. You need to provide the constant directly. Ruby’s constant lookup rules apply.</p>

<pre><code>html = cell(Comment::Cell::New, result["model"]).()
</code></pre>

<h3 id="cells-4-trailblazer-layouts" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Layouts</span></h3>

<p class="">It’s a common pattern to maintain a cell representing the application’s layout(s). Usually, it resides in a concept named after the application.</p>

<pre><code>├── app
│   ├── concepts
│   │   └── gemgem
│   │       ├── cell
│   │       │   ├── layout.rb
│   │       └── view
│   │           ├── layout.slim
</code></pre>

<p class="">Most times, the layout cell can be an empty subclass.</p>

<pre><code>module Gemgem::Cell
  class Layout &lt; Trailblazer::Cell
  end
end
</code></pre>

<p class="">The view <code class="text-purple">gemgem/view/layout.slim</code> contains a <code class="text-purple">yield</code> where the actual content goes.</p>

<pre><code>!!!
%html
  %head
    %title= "Gemgem"
    = stylesheet_link_tag 'application', media: 'all'
    = javascript_include_tag 'application'
  %body
    = yield
</code></pre>

<p class="">Wrapping the content cell (<code class="text-purple">Comment::Cell::New</code>) with the layout cell (<code class="text-purple">Gemgem::Cell::Layout</code>) happens via the public <code class="text-purple">:layout</code> option.</p>

<pre><code>concept("comment/cell/new", result["model"], layout: Gemgem::Cell::Layout)
</code></pre>

<p class="">This will render the <code class="text-purple">Comment::Cell::New</code>, instantiate <code class="text-purple">Gemgem::Cell::Layout</code> and pass through the context object, then render the layout around it.</p>

<h2 id="cells-4-testing" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span>Testing</span></h2>

<p class="">Only a few methods are needed to integrate cells testing into your test suite. This is implemented in <code class="text-purple">Cell::Testing</code>.</p>

<h3 id="cells-4-testing-api" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>API</span></h3>

<p class="">Regardless of your test environment (Rspec, MiniTest, etc.) the following methods are available.</p>

<pre><code>module Testing
  concept(name, *args) # instantiates Cell::Concept subclass.
  cell(name, *args) # instantiates Cell::ViewModel subclass.
end
</code></pre>

<p class="">Calling the two helpers does exactly the same it does in a controller or a view.</p>

<p class="">Usually, this will give you the cell instance. It’s your job to invoke a state using <code class="text-purple">#call</code>.</p>

<pre><code>it "renders cell" do
  cell(:song, @song).() #=&gt; HTML / Capybara::Node::Simple
end
</code></pre>

<p class="">However, when invoked with <code class="text-purple">:collection</code>, it will render the cell collection for you. In that case, <code class="text-purple">#cell</code>/<code class="text-purple">#concept</code> will return a string of markup.</p>

<pre><code>it "renders collection" do
  cell(:song, collection: [@song, @song]) #=&gt; HTML
end
</code></pre>

<h3 id="cells-4-testing-minitest-test-unit" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>MiniTest, Test::Unit</span></h3>

<p class="">In case you’re <em>not</em> using Rspec, derive your tests from <code class="text-purple">Cell::TestCase</code>.</p>

<pre><code>class SongCellTest &lt; Cell::TestCase
  it "renders" do
    cell(:song, @song).().must_have_selector "b"
  end
end
</code></pre>

<p class="">You can also include <code class="text-purple">Cell::Testing</code> into an arbitrary test class if you’re not happy with <code class="text-purple">Cell::TestCase</code>.</p>

<h4 id="optional-controller">Optional Controller</h4>

<p class="">If your cells have a controller dependency, you can set it using <code class="text-purple">::controller</code>.</p>

<pre><code>class SongCellTest &lt; Cell::TestCase
  controller SongsController
</code></pre>

<p class="">This will provide a testable controller via <code class="text-purple">#controller</code>, which is automatically used in <code class="text-purple">Testing#concept</code> and <code class="text-purple">Testing#cell</code>.</p>

<h3 id="cells-4-testing-rspec" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Rspec</span></h3>

<p class="">Rspec works with the <a href="https://github.com/apotonick/rspec-cells" class="underline text-purple"><code class="text-purple">rspec-cells</code> gem</a>.</p>

<p class="">Make sure to install it.</p>

<pre><code>gem "rspec-cells"
</code></pre>

<p class="">You can use the <code class="text-purple">#cell</code> and <code class="text-purple">#concept</code> builders in your specs.</p>

<pre><code>describe SongCell, type: :cell do
  subject { cell(:song, Song.new).(:show) }

  it { expect(subject).to have_content "Song#show" }
end
</code></pre>

<h4 id="optional-controller-1">Optional Controller</h4>

<p class="">If your cells have a controller dependency, you can set it using <code class="text-purple">::controller</code>.</p>

<pre><code>describe SongCell do
  controller SongsController
</code></pre>

<p class="">This will provide a testable controller via <code class="text-purple">#controller</code>.</p>

<h3 id="cells-4-testing-capybara-support" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Capybara Support</span></h3>

<p class="">Per default, Capybara support is enabled in <code class="text-purple">Cell::TestCase</code> when the Capybara gem is loaded. This works for both Minitest and Rspec.</p>

<p class="">The only changed behavior will be that the result of <code class="text-purple">Cell#call</code> is wrapped into a <code class="text-purple">Capybara::Node::Simple</code> instance, which allows to call matchers on the result.</p>

<pre><code>cell(:song, @song).().must_have_selector "b" # example for MiniTest::Spec.
</code></pre>

<p class="">In case you need access to the actual markup string, use <code class="text-purple">#to_s</code>. Note that this is a Cells-specific extension.</p>

<pre><code>cell(:song, @song).().to_s.must_match "by SNFU" # example for MiniTest::Spec.
</code></pre>

<p class="">You can disable Capybara for Cells even when the gem is loaded.</p>

<pre><code>Cell::Testing.capybara = false
</code></pre>

<h3 id="cells-4-testing-capybara-with-minitest-rails-" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Capybara with Minitest (Rails)</span></h3>

<p class="">With Minitest, the recommended approach is to use the <code class="text-purple">minitest-rails-capybara</code> gem.</p>

<pre><code>group :test do
  gem "minitest-rails-capybara"
end
</code></pre>

<p class="">You also have to include certain Capybara modules into your test case. It’s a good idea to do this in your app-wide <code class="text-purple">test_helper.rb</code>.</p>

<pre><code>Cell::TestCase.class_eval do
  include ::Capybara::DSL
  include ::Capybara::Assertions
end
</code></pre>

<p class="">If you miss to do so, you will get an exception similar to the following.</p>

<pre><code>NoMethodError: undefined method `must_have_css' for #&lt;User::Cell::Index:0xb5a6c&gt;
</code></pre>

<p class="">Here’s an example <a href="https://github.com/apotonick/gemgem-trbrb/blob/7cc8c7a0de78ba00092957a32d8cd234f102c73f/test/test_helper.rb#L19" class="underline text-purple">how we do it</a> in Gemgem.</p>

<h3 id="cells-4-testing-capybara-with-minitest-spec" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Capybara with Minitest::Spec</span></h3>

<p class="">In a non-Rails environment, the <a href="https://github.com/ordinaryzelig/capybara_minitest_spec" class="underline text-purple">capybara_minitest_spec</a> gem is what we use.</p>

<pre><code>group :test do
  gem "capybara_minitest_spec"
end
</code></pre>

<p class="">Add the following to your <code class="text-purple">test_helper.rb</code>.</p>

<pre><code>require "capybara_minitest_spec"
Cell::Testing.capybara = true
</code></pre>

<p class="">After including the <code class="text-purple">Testing</code> module, you’re ready to run specs against cells.</p>

<pre><code>class NavigationCellTest &lt; Minitest::Spec
  include Cell::Testing

  it "renders avatar when user provided" do
    html = cell(Pro::Cell::Navigation, user).()

    html.must_have_css "#avatar-signed-in"
    html.to_s.must_match "Signed in: nick@trb.to"
  end
end
</code></pre>

<h2 id="cells-4-rendering" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span>Rendering</span></h2>

<h3 id="cells-4-rendering-view-paths" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>View Paths</span></h3>

<p class="">Every cell class can have multiple view paths. However, I advise you not to have more than two, better one, unless you’re implementing a cell in an engine. This is simply to prevent unexpected behavior.</p>

<p class="">View paths are set via the <code class="text-purple">::view_paths</code> method.</p>

<pre><code>class Cell::ViewModel
  self.view_paths = ["app/cells"]
</code></pre>

<p class="">Use the setter to override the view paths entirely, or append as follows.</p>

<pre><code>class Shopify::CartCell
  self.view_paths &lt;&lt; "/var/shopify/app/cells"
</code></pre>

<p class="">The <code class="text-purple">view_paths</code> variable is an inheritable array.</p>

<p class="">A trick to quickly find out about the directory lookup list is to inspect the <code class="text-purple">::prefixes</code> class method of your particular cell.</p>

<pre><code>puts Shopify::CartCell.prefixes
#=&gt; ["app/cells/shopify/cart", "/var/shopify/app/cells/shopify/cart"]
</code></pre>

<p class="">This is the authorative list when finding templates. It will include inherited cell’s directories as well when you used inheritance. The list is traversed from left to right.</p>

<h3 id="cells-4-rendering-partials" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Partials</span></h3>

<p class="">Even considered a taboo, you may render global partials from Cells.</p>

<pre><code>SongCell &lt; Cell::ViewModel
  include Partial

  def show
    render partial: "../views/shared/sidebar.html"
  end
</code></pre>

<p class="">Make sure to use the <code class="text-purple">:partial</code> option and specify a path relative to the cell’s view path. Cells will automatically add the format and the terrible underscore, resulting in <code class="text-purple">"../views/shared/_sidebar.html.erb"</code>.</p>

<h2 id="cells-4-rails" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span>Rails</span></h2>

<p class="">When using cells in a Rails app there’s several nice features to benefit from.</p>

<h3 id="cells-4-rails-asset-pipeline" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Asset Pipeline</span></h3>

<p class="">Cells can bundle their own assets in the cell’s view directory. This is a very popular way of writing highly reusable components.</p>

<p class="">It works with both engine cells and application cells.</p>

<pre><code>├── cells
│   ├── comment_cell.rb
│   ├── comment
│   │   ├── show.haml
│   │   ├── comment.css
│   │   ├── comment.coffee
</code></pre>

<p class="">You need to register the cells with bundled assets. Preferably, this happens in <code class="text-purple">config/application.rb</code> of the main application.</p>

<pre><code>class Application &lt; Rails::Application
  # ..
  config.cells.with_assets = ["comment_cell"]
</code></pre>

<p class="">The names added to <code class="text-purple">with_assets</code> have to be the fully qualified, underscored cell name. They will get <code class="text-purple">constantize</code>d to find the cell name at runtime.</p>

<p class="">If using namespaces, this might be something along <code class="text-purple">config.cells.with_assets = ["my_engine/song/cell"]</code>.</p>

<p class="">In <code class="text-purple">app/assets/application.js</code>, you need to add the cell JavaScript assets manually.</p>

<pre><code>//=# require comments
</code></pre>

<p class="">Likewise, you have to reference the cell’s CSS files in <code class="text-purple">app/assets/application.css</code>.</p>

<pre><code>/*
 *= require comment
 */
</code></pre>

<h3 id="cells-4-rails-asset-pipeline-with-trailblazer" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Asset Pipeline With Trailblazer</span></h3>

<p class="">With Trailblazer, cells follow a different naming structure.</p>

<pre><code>├── concepts
│   │   └── comment
│   │       ├── cell
│   │       │   ├── index.rb
│   │       │   └── show.rb
│   │       └── view
│   │           ├── index.haml
│   │           ├── show.haml
│   │           └── comment.scss
</code></pre>

<p class="">The <code class="text-purple">comment</code> concept here will provide <code class="text-purple">Comment::Cell::Index</code> and <code class="text-purple">Comment::Cell::Show</code>. Both bundle their assets in the <code class="text-purple">comment/view</code> directory.</p>

<p class="">To add this to Rails’ asset pipeline, you need to reference one of the cell classes in <code class="text-purple">config/application.rb</code>.</p>

<pre><code>class Application &lt; Rails::Application
  # ..
  config.cells.with_assets = ["comment/cell/index"] # one of the two is ok.
</code></pre>

<p class="">You still need to <code class="text-purple">require</code> the JS and CSS files. Here’s an example for <code class="text-purple">app/assets/application.css</code>.</p>

<pre><code>/*
 *= require comment # refers to concepts/comment/view/comment.scss
 */
</code></pre>

<h3 id="cells-4-rails-assets-troubleshooting" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Assets Troubleshooting</span></h3>

<p class="">The Asset Pipeline is a complex system. If your assets are not compiled, start debugging in <a href="https://github.com/trailblazer/cells-rails/blob/master/lib/cell/railtie.rb" class="underline text-purple">Cells’ railtie</a> and uncomment the <code class="text-purple">puts</code> in the <code class="text-purple">cells.update_asset_paths</code> initializer to see what directories get added.</p>

<p class="">Cell classes need to be loaded when precompiling assets! Make sure your <code class="text-purple">application.rb</code> contains the following setting (per default, this is turned <em>on</em>).</p>

<pre><code>config.assets.initialize_on_precompile = true
</code></pre>

<p class="">You need to compile assets using this command, which is <a href="http://stackoverflow.com/a/12167790/465070" class="underline text-purple">explained here</a>.</p>

<pre><code>rake assets:precompile:all RAILS_ENV=development RAILS_GROUPS=assets
</code></pre>

<h3 id="cells-4-rails-global-partials" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Global Partials</span></h3>

<p class="">Although not recommended, you can also render global partials from a cell. Be warned, though, that they will be rendered using our stack, and you might have to include helpers into your view model.</p>

<p class="">This works by including <code class="text-purple">Partial</code> and the corresponding <code class="text-purple">:partial</code> option.</p>

<pre><code class="language-ruby">class Cell &lt; Cell::ViewModel
  include Partial

  def show
    render partial: "../views/shared/map.html" # app/views/shared/map.html.haml
  end
</code></pre>

<p class="">The provided path is relative to your cell’s <code class="text-purple">::view_paths</code> directory. The format has to be added to the file name, the template engine suffix will be used from the cell.</p>

<p class="">You can provide the format in the <code class="text-purple">render</code> call, too.</p>

<pre><code class="language-ruby">render partial: "../views/shared/map", formats: [:html]
</code></pre>

<p class="">This was mainly added to provide compatibility with 3rd-party gems like <a href="https://github.com/apotonick/kaminari-cells" class="underline text-purple">Kaminari and Cells</a> that rely on rendering partials within a cell.</p>

<h3 id="cells-4-rails-generators" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Generators</span></h3>

<p class="">In Rails, you can generate cells and concept cells.</p>

<pre><code class="language-ruby">rails generate cell comment
</code></pre>

<p class="">Or, TRB-style concept cells.</p>

<pre><code class="language-ruby">rails generate concept comment
</code></pre>

<h3 id="cells-4-rails-engine-cells" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Engine Cells</span></h3>

<p class="">You can bundle cells into Rails engines and maximize a clean, component architecture by making your view models easily distributable and overridable.</p>

<p class="">This pretty much works out-of-the-box, you write cells and push them into an engine. The only thing differing is that engine cells have to set their <code class="text-purple">view_paths</code> manually to point to the gem directory.</p>

<h3 id="cells-4-rails-engine-view-paths" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Engine View Paths</span></h3>

<p class="">Each engine cell has to set its <code class="text-purple">view_paths</code>.</p>

<p class="">The easiest way is to do this in a base cell in your engine.</p>

<pre><code>module MyEngine
  class Cell &lt; Cell::Concept
    view_paths = ["#{MyEngine::Engine.root}/app/concepts"]
  end
end
</code></pre>

<p class="">The <code class="text-purple">view_paths</code> is inherited, you only have to define it once when using inheritance within your engine.</p>

<pre><code>module MyEngine
  class Song::Cell &lt; Cell # inherits from MyEngine::Cell
</code></pre>

<p class="">This will <em>not</em> allow overriding views of this engine cell in <code class="text-purple">app/cells</code> as it is not part of the engine cell’s <code class="text-purple">view_paths</code>. When rendering <code class="text-purple">MyEngine::User::Cell</code> or a subclass, it will <em>not</em> look in <code class="text-purple">app/cells</code>.</p>

<p class="">To achieve just that, you may append the engine’s view path instead of overwriting it.</p>

<pre><code>class MyEngine::User::Cell &lt; Cell::Concept
  view_paths &lt;&lt; "#{MyEngine::Engine.root}/app/concepts"
end
</code></pre>

<h3 id="cells-4-rails-engine-render-problems" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Engine Render problems</span></h3>

<p class="">You might have to include cells’ template gem into your <strong>application’s</strong> <code class="text-purple">Gemfile</code>. This will properly require the extension.</p>

<h3 id="cells-4-rails-engine-namespace-helpers" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Engine Namespace Helpers</span></h3>

<p class="">If you need namespaced helpers, include the respective helper in your engine cell.</p>

<pre><code class="language-ruby">module MyEngine
  class CommentCell &lt; Cell::ViewModel
    include Engine.routes.url_helpers

    def comment_url
      link_to model.title, engine_specific_path_without_any_namespaces_needed
    end
  end
end


# application Gemfile
gem "cells-erb"
</code></pre>

<h3 id="cells-4-rails-translation-and-i18n-helper" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Translation and I18N Helper</span></h3>

<p class="">You can use the <code class="text-purple">#t</code> helper.</p>

<pre><code>require "cell/translation"

class Admin::Comment::Cell &lt; Cell::Concept
  include ActionView::Helpers::TranslationHelper
  include ::Cell::Translation

  def show
    t(".greeting")
  end
end
</code></pre>

<p class="">This will lookup the I18N path <code class="text-purple">admin.comment.greeting</code>.</p>

<p class="">Setting a differing translation path works with <code class="text-purple">::translation_path</code>.</p>

<pre><code>class Admin::Comment::Cell &lt; Cell::Concept
  include Cell::Translation
  self.translation_path = "cell.admin"
</code></pre>

<p class="">The lookup will now be <code class="text-purple">cell.admin.greeting</code>.</p>

<h3 id="cells-4-rails-asset-helper" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Asset Helper</span></h3>

<p class="">When using asset path helpers like <code class="text-purple">image_tag</code> that render different paths in production, please simply delegate to the controller.</p>

<pre><code>class Comment::Cell &lt; Cell::Concept
  delegates :parent_controller, :image_tag
</code></pre>

<p class="">The delegation fixes the <a href="https://github.com/apotonick/cells/issues/214" class="underline text-purple">well-known problem</a> of the cell rendering the “wrong” path when using Sprockets. Please note that this fix is necessary due to the way Rails includes helpers and accesses global data.</p>

<h2 id="cells-4-template-engines" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span>Template Engines</span></h2>

<p class="">Cells supports various template engines.</p>

<p class="">We provide support for Haml, Erb, and Slim. You can also write <a href="#cells-template-engines-your-own" class="underline text-purple">your own</a> template engine.</p>

<p class="">In a non-Rails environment, you need to include the respective module into your cells, so it knows what template to find.</p>

<pre><code>class SongCell &lt; Cell::ViewModel
  include Cell::Erb
  # include Cell::Haml
  # include Cell::Slim
</code></pre>

<p class="">Note that you can only include <em>one engine per class</em>. This is due to problems with helpers in Rails and the way they have to be fixed in combination with Cells.</p>

<h3 id="multiple-template-engines-in-rails">Multiple Template Engines in Rails</h3>

<p class="">When including more than one engine in your Gemfile in Rails, the last one wins. Since each gem includes itself into <code class="text-purple">Cell::ViewModel</code>, unfortunately there can only be one global engine.</p>

<p class="">Currently, there’s no clean way but to disable automatic inclusion from each gem (not yet implemented) and then include template modules into your application cells manually.</p>

<h3 id="cells-4-template-engines-erb" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>ERB</span></h3>

<h3 id="cells-4-template-engines-haml" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Haml</span></h3>

<h3 id="cells-4-template-engines-slim" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Slim</span></h3>

<h3 id="cells-4-template-engines-your-own" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Your Own</span></h3>

<p class="">Theoretically, you can use any template engine supported by Tilt.</p>

<p class="">To activate it in a cell, you only need to override <code class="text-purple">#template_options_for</code>.</p>

<pre><code>class SongCell &lt; Cell::ViewModel
  def template_options_for(options)
    {
      template_class: Tilt, # or Your::Template.
      suffix:         "your"
  }
  end
</code></pre>

<p class="">This will use <code class="text-purple">Tilt</code> to instantiate a template to be evaluated. The <code class="text-purple">:suffix</code> is needed for Cells when finding the view.</p>

<h2 id="cells-4-troubleshooting" class="text-2xl font-bold text-neutral-500 lg:text-3xl py-2 flex items-center"><span>Troubleshooting</span></h2>

<h3 id="cells-4-troubleshooting-helper-inclusion-order" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Helper Inclusion Order</span></h3>

<p class="">One of the many problems with Rails helper implementation is that the inclusion order matters. This can lead to problems with the following exception.</p>

<pre><code>undefined method `output_buffer=' for #&lt;Comment::Cell:0xb518d8cc&gt;
</code></pre>

<p class="">Usually, the problem arises when you have initializers to setup your application cell. When including helpers here, they might be included before the <code class="text-purple">cells</code> gem has a chance to include its fixes.</p>

<p class="">Please include your template engine module explicitly then, <em>after</em> your standard helper inclusions.</p>

<pre><code># config/initializers/trailblazer.rb

Cell::Concept.class_eval do
  include ActionView::Helpers::TranslationHelpers # include your helpers here.
  include Cell::Erb # or Cell::Slim, or Cell::Haml after that
end
</code></pre>

<h3 id="cells-4-troubleshooting-form-helpers" class="font-bold text-neutral-500 lg:text-2xl text-xl py-2 flex items-center"><span>Form helpers</span></h3>

<p class="">Sometimes you have to manually include Rails helpers into your cell classes. For instance, the following exception originating from <code class="text-purple">lib/action_view/helpers/form_options_helper.rb</code> might disturb your sunny day.</p>

<pre><code>undefined method `collection_select' for #&lt;...::Cell::
</code></pre>

<p class="">While we still don’t understand the root of the problem, it can be fixed by including <code class="text-purple">FormOptionsHelper</code>.</p>

<pre><code>module Comment::Cell
  class New &lt; Trailblazer::Cell
    include ActionView::Helpers::FormOptionsHelper
    # ...
  end
end
</code></pre>

<p class="">Likewise, when using <code class="text-purple">simple_form</code> you need to manually include its helper or you will encounter the following exception.</p>

<pre><code>undefined method `simple_form_for' for #&lt;...::Cell::
</code></pre>

<p class="">It is easily fixed with an <code class="text-purple">include</code>.</p>

<pre><code>module Transaction::Cell
  class New &lt; Trailblazer::Cell
    include SimpleForm::ActionViewExtensions::FormHelper
    # you can include more than one helper:
    # include ActionView::Helpers::FormOptionsHelper
</code></pre>


        </div>

            <!-- 5.5rem is lg navbar height -->
        <div class="bg-white h-screen w-56 sticky top-[5.5rem]" id="right-toc">
          <div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-cells-4-overview">
  <h4 class="font-base font-bold leading-10 pl-2">
     Overview
  </h4>

  
    <a class="block px-2 leading-8" href="#cells-4-overview-view-model">View Model</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-overview-rendering-a-cell">Rendering a Cell</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-overview-cell-class">Cell Class</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-overview-cell-views">Cell Views</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-overview-no-helpers">No Helpers</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-overview-properties">Properties</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-overview-testing">Testing</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-overview-more">More</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-overview-context-object">Context Object</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-overview-success">Success</a>

    
  
</div>


<div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-cells-4-api">
  <h4 class="font-base font-bold leading-10 pl-2">
     API
  </h4>

  
    <a class="block px-2 leading-8" href="#cells-4-api-anatomy">Anatomy</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-show">Show</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-initialize">Initialize</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-model">Model</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-property">Property</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-options">Options</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-invocation">Invocation</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-call">Call</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-default-show">Default Show</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-instantiation-helper">Instantiation Helper</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-file-structure">File Structure</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-render">Render</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-instance-methods">Instance Methods</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-yield">Yield</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-collection">Collection</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-external-layout">External Layout</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-view-paths">View Paths</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-template-formats">Template Formats</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-html-escaping">HTML Escaping</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-context-object">Context Object</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-nesting">Nesting</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-view-inheritance">View Inheritance</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-builder">Builder</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-caching">Caching</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-cache-options">Cache Options</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-conditional-caching">Conditional Caching</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-cache-keys">Cache Keys</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-debugging-cache">Debugging Cache</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-cache-inheritance">Cache Inheritance</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-api-testing-caching">Testing Caching</a>

    
  
</div>


<div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-cells-4-trailblazer">
  <h4 class="font-base font-bold leading-10 pl-2">
     Trailblazer
  </h4>

  
    <a class="block px-2 leading-8" href="#cells-4-trailblazer-installation">Installation</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-trailblazer-file-structure">File Structure</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-trailblazer-naming">Naming</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-trailblazer-default-show">Default Show</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-trailblazer-view-names">View Names</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-trailblazer-invocation">Invocation</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-trailblazer-layouts">Layouts</a>

    
  
</div>


<div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-cells-4-testing">
  <h4 class="font-base font-bold leading-10 pl-2">
     Testing
  </h4>

  
    <a class="block px-2 leading-8" href="#cells-4-testing-api">API</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-testing-minitest-test-unit">MiniTest, Test::Unit</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-testing-rspec">Rspec</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-testing-capybara-support">Capybara Support</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-testing-capybara-with-minitest-rails-">Capybara with Minitest (Rails)</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-testing-capybara-with-minitest-spec">Capybara with Minitest::Spec</a>

    
  
</div>


<div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-cells-4-rendering">
  <h4 class="font-base font-bold leading-10 pl-2">
     Rendering
  </h4>

  
    <a class="block px-2 leading-8" href="#cells-4-rendering-view-paths">View Paths</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-rendering-partials">Partials</a>

    
  
</div>


<div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-cells-4-rails">
  <h4 class="font-base font-bold leading-10 pl-2">
     Rails
  </h4>

  
    <a class="block px-2 leading-8" href="#cells-4-rails-asset-pipeline">Asset Pipeline</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-rails-asset-pipeline-with-trailblazer">Asset Pipeline With Trailblazer</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-rails-assets-troubleshooting">Assets Troubleshooting</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-rails-global-partials">Global Partials</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-rails-generators">Generators</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-rails-engine-cells">Engine Cells</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-rails-engine-view-paths">Engine View Paths</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-rails-engine-render-problems">Engine Render problems</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-rails-engine-namespace-helpers">Engine Namespace Helpers</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-rails-translation-and-i18n-helper">Translation and I18N Helper</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-rails-asset-helper">Asset Helper</a>

    
  
</div>


<div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-cells-4-template-engines">
  <h4 class="font-base font-bold leading-10 pl-2">
     Template Engines
  </h4>

  
    <a class="block px-2 leading-8" href="#cells-4-template-engines-erb">ERB</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-template-engines-haml">Haml</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-template-engines-slim">Slim</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-template-engines-your-own">Your Own</a>

    
  
</div>


<div class="display_none bg-white p-5 w-56 shrink-0 text-bg-blue overflow-y-scroll top-22" id="right-toc-cells-4-troubleshooting">
  <h4 class="font-base font-bold leading-10 pl-2">
     Troubleshooting
  </h4>

  
    <a class="block px-2 leading-8" href="#cells-4-troubleshooting-helper-inclusion-order">Helper Inclusion Order</a>

    
  
    <a class="block px-2 leading-8" href="#cells-4-troubleshooting-form-helpers">Form helpers</a>

    
  
</div>


        </div>
      </div>
    </div>
  </div>
</section>


<footer class="lg:text-left bg-bg-blue py-16 text-white text-center text-base">
  <div class="lg:flex justify-between w-11/12 max-w-[80rem] mx-auto">
    <div class="lg:flex lg:flex-col lg:justify-between">
      <a href="/2.1/" class="block shrink-0 w-fit mx-auto lg:mx-0" >
        <img class="w-48" src="/assets/logo_white_ruby-01c45713d0879788514c52d65ac53e92d7735b42cec0baf6e080b08f9a0fb595.svg" />
      </a>
      <div class="lg:block hidden">
        © 2023 Trailblazer GmbH
      </div>
    </div>
    <div class="lg:flex lg:gap-20 xl:gap-40">
      <div class="lg:mt-0 flex flex-col gap-5 mt-15">
        <a class="font-bold text-xl" href="#">Documentation</a>
        <a href="#">About</a>
        <a href="#">Community</a>
        <a href="#">Blog</a>
        <a href="#">Legal</a>
      </div>
      <div class="lg:mt-0 flex flex-col gap-5 mt-15">
        <a class="font-bold text-xl" href="#">Products</a>
        <a href="#">Trailblazer</a>
        <a href="#">Trailblazer Pro</a>
        <a href="#">Support</a>
      </div>
      <div class="lg:mt-0 flex flex-col gap-5 mt-15">
        <a class="font-bold text-xl" href="#">Learn</a>
        <a href="#">What is Trailblazer?</a>
        <a href="#">Trailblazer PRO</a>
        <a href="#">Tips and Tutorials</a>
        <a href="https://trailblazer.zulipchat.com">Chat</a>
      </div>
    </div>
  </div>
  <div class="lg:hidden mt-15">
    © 2023 Trailblazer GmbH
  </div>
</footer>


  </body>
</html>
